!function(e,t,r){"use strict";function n(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var s=n(r);function i(){return"undefined"==typeof unsafeWindow?window:unsafeWindow}function o(e,t,r){for(var n=0,s=0,i=r.length;s<i;s++)(n=r.charCodeAt(s))<128?e.setUint8(t++,n):(n<2048?e.setUint8(t++,192|n>>6):(n<55296||57344<=n?e.setUint8(t++,224|n>>12):(s++,n=65536+((1023&n)<<10|1023&r.charCodeAt(s)),e.setUint8(t++,240|n>>18),e.setUint8(t++,128|n>>12&63)),e.setUint8(t++,128|n>>6&63)),e.setUint8(t++,128|63&n))}var a={encode:function(e,t,r){let n;return n=Array.isArray(e)?{type:2,data:e,options:{compress:!0},nsp:"/"}:{type:2,data:["blueboat_SEND_MESSAGE",{room:r,key:e,data:t}],options:{compress:!0},nsp:"/"},function(e){var t=[],r=[],n=function e(t,r,n){var s=typeof n,i=0,o=0,a=0,c=0,h=0,l=0;if("string"===s){if((h=function(e){for(var t=0,r=0,n=0,s=e.length;n<s;n++)(t=e.charCodeAt(n))<128?r+=1:t<2048?r+=2:t<55296||57344<=t?r+=3:(n++,r+=4);return r}(n))<32)t.push(160|h),l=1;else if(h<256)t.push(217,h),l=2;else if(h<65536)t.push(218,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("String too long");t.push(219,h>>24,h>>16,h>>8,h),l=5}return r.push({h:n,u:h,t:t.length}),l+h}if("number"===s)return Math.floor(n)===n&&isFinite(n)?0<=n?n<128?(t.push(n),1):n<256?(t.push(204,n),2):n<65536?(t.push(205,n>>8,n),3):n<4294967296?(t.push(206,n>>24,n>>16,n>>8,n),5):(a=n/Math.pow(2,32)|0,c=n>>>0,t.push(207,a>>24,a>>16,a>>8,a,c>>24,c>>16,c>>8,c),9):-32<=n?(t.push(n),1):-128<=n?(t.push(208,n),2):-32768<=n?(t.push(209,n>>8,n),3):-2147483648<=n?(t.push(210,n>>24,n>>16,n>>8,n),5):(a=Math.floor(n/Math.pow(2,32)),c=n>>>0,t.push(211,a>>24,a>>16,a>>8,a,c>>24,c>>16,c>>8,c),9):(t.push(203),r.push({o:n,u:8,t:t.length}),9);if("object"===s){if(null===n)return t.push(192),1;if(Array.isArray(n)){if((h=n.length)<16)t.push(144|h),l=1;else if(h<65536)t.push(220,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("Array too large");t.push(221,h>>24,h>>16,h>>8,h),l=5}for(i=0;i<h;i++)l+=e(t,r,n[i]);return l}if(n instanceof Date){var u=n.getTime();return a=Math.floor(u/Math.pow(2,32)),c=u>>>0,t.push(215,0,a>>24,a>>16,a>>8,a,c>>24,c>>16,c>>8,c),10}if(n instanceof ArrayBuffer){if((h=n.byteLength)<256)t.push(196,h),l=2;else if(h<65536)t.push(197,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("Buffer too large");t.push(198,h>>24,h>>16,h>>8,h),l=5}return r.push({l:n,u:h,t:t.length}),l+h}if("function"==typeof n.toJSON)return e(t,r,n.toJSON());var f=[],d="",p=Object.keys(n);for(i=0,o=p.length;i<o;i++)"function"!=typeof n[d=p[i]]&&f.push(d);if((h=f.length)<16)t.push(128|h),l=1;else if(h<65536)t.push(222,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("Object too large");t.push(223,h>>24,h>>16,h>>8,h),l=5}for(i=0;i<h;i++)l+=e(t,r,d=f[i]),l+=e(t,r,n[d]);return l}if("boolean"===s)return t.push(n?195:194),1;if("undefined"===s)return t.push(212,0,0),3;throw new Error("Could not encode")}(t,r,e),s=new ArrayBuffer(n),i=new DataView(s),a=0,c=0,h=-1;0<r.length&&(h=r[0].t);for(var l,u=0,f=0,d=0,p=t.length;d<p;d++)if(i.setUint8(c+d,t[d]),d+1===h){if(u=(l=r[a]).u,f=c+h,l.l)for(var g=new Uint8Array(l.l),y=0;y<u;y++)i.setUint8(f+y,g[y]);else l.h?o(i,f,l.h):void 0!==l.o&&i.setFloat64(f,l.o);c+=u,r[++a]&&(h=r[a].t)}let m=Array.from(new Uint8Array(s));return m.unshift(4),new Uint8Array(m).buffer}(n)},decode:function(e){function t(e){if(this.t=0,e instanceof ArrayBuffer)this.i=e,this.s=new DataView(this.i);else{if(!ArrayBuffer.isView(e))return null;this.i=e.buffer,this.s=new DataView(this.i,e.byteOffset,e.byteLength)}}t.prototype.g=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=this.v();return t},t.prototype.M=function(e){for(var t={},r=0;r<e;r++)t[this.v()]=this.v();return t},t.prototype.h=function(e){var t=function(e,t,r){for(var n="",s=0,i=t,o=t+r;i<o;i++){var a=e.getUint8(i);if(128&a)if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));65536<=(s=(7&a)<<18|(63&e.getUint8(++i))<<12|(63&e.getUint8(++i))<<6|63&e.getUint8(++i))?(s-=65536,n+=String.fromCharCode(55296+(s>>>10),56320+(1023&s))):n+=String.fromCharCode(s)}else n+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++i))<<6|63&e.getUint8(++i));else n+=String.fromCharCode((31&a)<<6|63&e.getUint8(++i));else n+=String.fromCharCode(a)}return n}(this.s,this.t,e);return this.t+=e,t},t.prototype.l=function(e){var t=this.i.slice(this.t,this.t+e);return this.t+=e,t},t.prototype.v=function(){if(!this.s)return null;var e,t=this.s.getUint8(this.t++),r=0,n=0,s=0,i=0;if(t<192)return t<128?t:t<144?this.M(15&t):t<160?this.g(15&t):this.h(31&t);if(223<t)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return r=this.s.getUint8(this.t),this.t+=1,this.l(r);case 197:return r=this.s.getUint16(this.t),this.t+=2,this.l(r);case 198:return r=this.s.getUint32(this.t),this.t+=4,this.l(r);case 199:return r=this.s.getUint8(this.t),n=this.s.getInt8(this.t+1),this.t+=2,[n,this.l(r)];case 200:return r=this.s.getUint16(this.t),n=this.s.getInt8(this.t+2),this.t+=3,[n,this.l(r)];case 201:return r=this.s.getUint32(this.t),n=this.s.getInt8(this.t+4),this.t+=5,[n,this.l(r)];case 202:return e=this.s.getFloat32(this.t),this.t+=4,e;case 203:return e=this.s.getFloat64(this.t),this.t+=8,e;case 204:return e=this.s.getUint8(this.t),this.t+=1,e;case 205:return e=this.s.getUint16(this.t),this.t+=2,e;case 206:return e=this.s.getUint32(this.t),this.t+=4,e;case 207:return s=this.s.getUint32(this.t)*Math.pow(2,32),i=this.s.getUint32(this.t+4),this.t+=8,s+i;case 208:return e=this.s.getInt8(this.t),this.t+=1,e;case 209:return e=this.s.getInt16(this.t),this.t+=2,e;case 210:return e=this.s.getInt32(this.t),this.t+=4,e;case 211:return s=this.s.getInt32(this.t)*Math.pow(2,32),i=this.s.getUint32(this.t+4),this.t+=8,s+i;case 212:return n=this.s.getInt8(this.t),this.t+=1,0===n?void(this.t+=1):[n,this.l(1)];case 213:return n=this.s.getInt8(this.t),this.t+=1,[n,this.l(2)];case 214:return n=this.s.getInt8(this.t),this.t+=1,[n,this.l(4)];case 215:return n=this.s.getInt8(this.t),this.t+=1,0===n?(s=this.s.getInt32(this.t)*Math.pow(2,32),i=this.s.getUint32(this.t+4),this.t+=8,new Date(s+i)):[n,this.l(8)];case 216:return n=this.s.getInt8(this.t),this.t+=1,[n,this.l(16)];case 217:return r=this.s.getUint8(this.t),this.t+=1,this.h(r);case 218:return r=this.s.getUint16(this.t),this.t+=2,this.h(r);case 219:return r=this.s.getUint32(this.t),this.t+=4,this.h(r);case 220:return r=this.s.getUint16(this.t),this.t+=2,this.g(r);case 221:return r=this.s.getUint32(this.t),this.t+=4,this.g(r);case 222:return r=this.s.getUint16(this.t),this.t+=2,this.M(r);case 223:return r=this.s.getUint32(this.t),this.t+=4,this.M(r)}throw new Error("Could not parse")};const r=function(e){var r=new t(e=e.slice(1)),n=r.v();return r.t===e.byteLength?n:null}(e);return r?.data?.[1]}};const c=new TextEncoder;function h(e,t,r){e.length>50?function(e,t,r){c.encodeInto(e,t.subarray(r))}(e,t,r):function(e,t,r){const n=e.length;let s=r,i=0;for(;i<n;){let r=e.charCodeAt(i++);if(4294967168&r){if(4294965248&r){if(r>=55296&&r<=56319&&i<n){const t=e.charCodeAt(i);56320==(64512&t)&&(++i,r=((1023&r)<<10)+(1023&t)+65536)}4294901760&r?(t[s++]=r>>18&7|240,t[s++]=r>>12&63|128,t[s++]=r>>6&63|128):(t[s++]=r>>12&15|224,t[s++]=r>>6&63|128)}else t[s++]=r>>6&31|192;t[s++]=63&r|128}else t[s++]=r}}(e,t,r)}new TextDecoder;class l{constructor(e,t){this.type=e,this.data=t}}class u extends Error{constructor(e){super(e);const t=Object.create(u.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:u.name})}}function f(e,t,r){const n=Math.floor(r/4294967296),s=r;e.setUint32(t,n),e.setUint32(t+4,s)}const d={type:-1,encode:function(e){if(e instanceof Date){return function({sec:e,nsec:t}){if(e>=0&&t>=0&&e<=17179869183){if(0===t&&e<=4294967295){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e),t}{const r=e/4294967296,n=4294967295&e,s=new Uint8Array(8),i=new DataView(s.buffer);return i.setUint32(0,t<<2|3&r),i.setUint32(4,n),s}}{const r=new Uint8Array(12),n=new DataView(r.buffer);return n.setUint32(0,t),f(n,4,e),r}}(function(e){const t=e.getTime(),r=Math.floor(t/1e3),n=1e6*(t-1e3*r),s=Math.floor(n/1e9);return{sec:r+s,nsec:n-1e9*s}}(e))}return null},decode:function(e){const t=function(e){const t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:{const e=t.getUint32(0);return{sec:4294967296*(3&e)+t.getUint32(4),nsec:e>>>2}}case 12:{const e=function(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}(t,4);return{sec:e,nsec:t.getUint32(0)}}default:throw new u(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}};class p{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(d)}register({type:e,encode:t,decode:r}){if(e>=0)this.encoders[e]=t,this.decoders[e]=r;else{const n=-1-e;this.builtInEncoders[n]=t,this.builtInDecoders[n]=r}}tryToEncode(e,t){for(let r=0;r<this.builtInEncoders.length;r++){const n=this.builtInEncoders[r];if(null!=n){const s=n(e,t);if(null!=s){return new l(-1-r,s)}}}for(let r=0;r<this.encoders.length;r++){const n=this.encoders[r];if(null!=n){const s=n(e,t);if(null!=s){return new l(r,s)}}}return e instanceof l?e:null}decode(e,t,r){const n=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return n?n(e,t,r):new l(t,e)}}function g(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):function(e){return e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer}(e)?new Uint8Array(e):Uint8Array.from(e)}p.defaultCodec=new p;let y=class e{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??p.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??100,this.initialBufferSize=e?.initialBufferSize??2048,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new e({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered){return this.clone().encodeSharedRef(e)}try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered){return this.clone().encode(e)}try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&"bigint"==typeof e?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)}resizeBuffer(e){const t=new ArrayBuffer(e),r=new Uint8Array(t),n=new DataView(t);r.set(this.bytes),this.view=n,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){!1===e?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error(`Too long string: ${e} bytes in UTF-8`);this.writeU8(219),this.writeU32(e)}}encodeString(e){const t=function(e){const t=e.length;let r=0,n=0;for(;n<t;){let s=e.charCodeAt(n++);if(4294967168&s)if(4294965248&s){if(s>=55296&&s<=56319&&n<t){const t=e.charCodeAt(n);56320==(64512&t)&&(++n,s=((1023&s)<<10)+(1023&t)+65536)}r+=4294901760&s?4:3}else r+=2;else r++}return r}(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),h(e,this.bytes,this.pos),this.pos+=t}encodeObject(e,t){const r=this.extensionCodec.tryToEncode(e,this.context);if(null!=r)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!=typeof e)throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`);this.encodeMap(e,t)}}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large binary: ${t}`);this.writeU8(198),this.writeU32(t)}const r=g(e);this.writeU8a(r)}encodeArray(e,t){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else{if(!(r<4294967296))throw new Error(`Too large array: ${r}`);this.writeU8(221),this.writeU32(r)}for(const r of e)this.doEncode(r,t+1)}countWithoutUndefined(e,t){let r=0;for(const n of t)void 0!==e[n]&&r++;return r}encodeMap(e,t){const r=Object.keys(e);this.sortKeys&&r.sort();const n=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else{if(!(n<4294967296))throw new Error(`Too large map object: ${n}`);this.writeU8(223),this.writeU32(n)}for(const n of r){const r=e[n];this.ignoreUndefined&&void 0===r||(this.encodeString(n),this.doEncode(r,t+1))}}encodeExtension(e){if("function"==typeof e.data){const t=e.data(this.pos+6),r=t.length;if(r>=4294967296)throw new Error(`Too large extension object: ${r}`);return this.writeU8(201),this.writeU32(r),this.writeI8(e.type),void this.writeU8a(t)}const t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large extension object: ${t}`);this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),function(e,t,r){const n=r/4294967296,s=r;e.setUint32(t,n),e.setUint32(t+4,s)}(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),f(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function m(e,t){return new y(t).encodeSharedRef(e)}var b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function w(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var v,E={};var O={},I=function(e,t){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},I(e,t)};function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}I(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var S=function(){return S=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},S.apply(this,arguments)};function T(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r}function _(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}function C(e,t){return function(r,n){t(r,n,e)}}function R(e,t,r,n,s,i){function o(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,c=n.kind,h="getter"===c?"get":"setter"===c?"set":"value",l=!t&&e?n.static?e:e.prototype:null,u=t||(l?Object.getOwnPropertyDescriptor(l,n.name):{}),f=!1,d=r.length-1;d>=0;d--){var p={};for(var g in n)p[g]="access"===g?{}:n[g];for(var g in n.access)p.access[g]=n.access[g];p.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(e||null))};var y=(0,r[d])("accessor"===c?{get:u.get,set:u.set}:u[h],p);if("accessor"===c){if(void 0===y)continue;if(null===y||"object"!=typeof y)throw new TypeError("Object expected");(a=o(y.get))&&(u.get=a),(a=o(y.set))&&(u.set=a),(a=o(y.init))&&s.unshift(a)}else(a=o(y))&&("field"===c?s.unshift(a):u[h]=a)}l&&Object.defineProperty(l,n.name,u),f=!0}function x(e,t,r){for(var n=arguments.length>2,s=0;s<t.length;s++)r=n?t[s].call(e,r):t[s].call(e);return n?r:void 0}function P(e){return"symbol"==typeof e?e:"".concat(e)}function D(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function k(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function $(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))}function N(e,t){var r,n,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(i=0)),i;)try{if(r=1,n&&(s=2&a[0]?n.return:a[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,a[1])).done)return s;switch(n=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){i.label=a[1];break}if(6===a[0]&&i.label<s[1]){i.label=s[1],s=a;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(a);break}s[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var U=Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function M(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||U(t,e,r)}function j(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function B(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o}function L(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(B(arguments[t]));return e}function F(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),s=0;for(t=0;t<r;t++)for(var i=arguments[t],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function V(e,t,r){if(r||2===arguments.length)for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))}function z(e){return this instanceof z?(this.v=e,this):new z(e)}function W(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,s=r.apply(e,t||[]),i=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",(function(e){return function(t){return Promise.resolve(t).then(e,h)}})),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){s[e]&&(n[e]=function(t){return new Promise((function(r,n){i.push([e,t,r,n])>1||a(e,t)}))},t&&(n[e]=t(n[e])))}function a(e,t){try{(r=s[e](t)).value instanceof z?Promise.resolve(r.value.v).then(c,h):l(i[0][2],r)}catch(e){l(i[0][3],e)}var r}function c(e){a("next",e)}function h(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function H(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,s){t[n]=e[n]?function(t){return(r=!r)?{value:z(e[n](t)),done:!1}:s?s(t):t}:s}}function q(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=j(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,s){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,s,(t=e[r](t)).done,t.value)}))}}}function J(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var G=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},K=function(e){return K=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},K(e)};function Y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=K(e),n=0;n<r.length;n++)"default"!==r[n]&&U(t,e,r[n]);return G(t,e),t}function X(e){return e&&e.__esModule?e:{default:e}}function Z(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function Q(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r}function ee(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function te(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var n,s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(s=n)}if("function"!=typeof n)throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var re="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function ne(e){function t(t){e.error=e.hasError?new re(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,n=0;return function s(){for(;r=e.stack.pop();)try{if(!r.async&&1===n)return n=0,e.stack.push(r),Promise.resolve().then(s);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(i).then(s,(function(e){return t(e),s()}))}else n|=1}catch(e){t(e)}if(1===n)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function se(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,(function(e,r,n,s,i){return r?t?".jsx":".js":!n||s&&i?n+s+"."+i.toLowerCase()+"js":e})):e}var ie,oe={__extends:A,__assign:S,__rest:T,__decorate:_,__param:C,__esDecorate:R,__runInitializers:x,__propKey:P,__setFunctionName:D,__metadata:k,__awaiter:$,__generator:N,__createBinding:U,__exportStar:M,__values:j,__read:B,__spread:L,__spreadArrays:F,__spreadArray:V,__await:z,__asyncGenerator:W,__asyncDelegator:H,__asyncValues:q,__makeTemplateObject:J,__importStar:Y,__importDefault:X,__classPrivateFieldGet:Z,__classPrivateFieldSet:Q,__classPrivateFieldIn:ee,__addDisposableResource:te,__disposeResources:ne,__rewriteRelativeImportExtension:se},ae=w(Object.freeze({__proto__:null,__addDisposableResource:te,get __assign(){return S},__asyncDelegator:H,__asyncGenerator:W,__asyncValues:q,__await:z,__awaiter:$,__classPrivateFieldGet:Z,__classPrivateFieldIn:ee,__classPrivateFieldSet:Q,__createBinding:U,__decorate:_,__disposeResources:ne,__esDecorate:R,__exportStar:M,__extends:A,__generator:N,__importDefault:X,__importStar:Y,__makeTemplateObject:J,__metadata:k,__param:C,__propKey:P,__read:B,__rest:T,__rewriteRelativeImportExtension:se,__runInitializers:x,__setFunctionName:D,__spread:L,__spreadArray:V,__spreadArrays:F,__values:j,default:oe})),ce={};function he(){return ie||(ie=1,function(e){var t;e.CloseCode=void 0,(t=e.CloseCode||(e.CloseCode={}))[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART";class r extends Error{constructor(e,t){super(t),this.name="ServerError",this.code=e}}e.ServerError=r}(ce)),ce}var le,ue,fe={},de={},pe={},ge={exports:{}};function ye(){return le||(le=1,function(e){const t=255,r=213;var n;e.OPERATION=void 0,(n=e.OPERATION||(e.OPERATION={}))[n.ADD=128]="ADD",n[n.REPLACE=0]="REPLACE",n[n.DELETE=64]="DELETE",n[n.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",n[n.MOVE_AND_ADD=160]="MOVE_AND_ADD",n[n.DELETE_AND_ADD=192]="DELETE_AND_ADD",n[n.CLEAR=10]="CLEAR",n[n.REVERSE=15]="REVERSE",n[n.MOVE=32]="MOVE",n[n.DELETE_BY_REFID=33]="DELETE_BY_REFID",n[n.ADD_BY_REFID=129]="ADD_BY_REFID",Symbol.metadata??=Symbol.for("Symbol.metadata");const s=Symbol("$track"),i=Symbol("$encoder"),o=Symbol("$decoder"),a=Symbol("$filter"),c=Symbol("$getByIndex"),h=Symbol("$deleteByIndex"),l=Symbol("$changes"),u=Symbol("$childType"),f=Symbol("$onEncodeEnd"),d=Symbol("$onDecodeEnd"),p=Symbol("$descriptors"),g="$__numFields",y="$__refTypeFieldIndexes",m="$__viewFieldIndexes",b="$__fieldIndexesByViewTag";let w;try{w=new TextEncoder}catch(e){}const v=new ArrayBuffer(8),E=new Int32Array(v),O=new Float32Array(v),I=new Float64Array(v),A=new BigInt64Array(v),S="undefined"!=typeof Buffer&&Buffer.byteLength?Buffer.byteLength:function(e,t){for(var r=0,n=0,s=0,i=e.length;s<i;s++)(r=e.charCodeAt(s))<128?n+=1:r<2048?n+=2:r<55296||r>=57344?n+=3:(s++,n+=4);return n};function T(e,t,r){for(var n=0,s=0,i=t.length;s<i;s++)(n=t.charCodeAt(s))<128?e[r.offset++]=n:n<2048?(e[r.offset]=192|n>>6,e[r.offset+1]=128|63&n,r.offset+=2):n<55296||n>=57344?(e[r.offset]=224|n>>12,e[r.offset+1]=128|n>>6&63,e[r.offset+2]=128|63&n,r.offset+=3):(s++,n=65536+((1023&n)<<10|1023&t.charCodeAt(s)),e[r.offset]=240|n>>18,e[r.offset+1]=128|n>>12&63,e[r.offset+2]=128|n>>6&63,e[r.offset+3]=128|63&n,r.offset+=4)}function _(e,t,r){e[r.offset++]=255&t}function C(e,t,r){e[r.offset++]=255&t}function R(e,t,r){e[r.offset++]=255&t,e[r.offset++]=t>>8&255}function x(e,t,r){e[r.offset++]=255&t,e[r.offset++]=t>>8&255}function P(e,t,r){e[r.offset++]=255&t,e[r.offset++]=t>>8&255,e[r.offset++]=t>>16&255,e[r.offset++]=t>>24&255}function D(e,t,r){const n=t>>24,s=t>>16,i=t>>8,o=t;e[r.offset++]=255&o,e[r.offset++]=255&i,e[r.offset++]=255&s,e[r.offset++]=255&n}function k(e,t,r){const n=Math.floor(t/Math.pow(2,32));D(e,t>>>0,r),D(e,n,r)}function $(e,t,r){const n=t/Math.pow(2,32)|0;D(e,t>>>0,r),D(e,n,r)}function N(e,t,r){A[0]=BigInt.asIntN(64,t),P(e,E[0],r),P(e,E[1],r)}function U(e,t,r){A[0]=BigInt.asIntN(64,t),P(e,E[0],r),P(e,E[1],r)}function M(e,t,r){O[0]=t,P(e,E[0],r)}function j(e,t,r){I[0]=t,P(e,E[0],r),P(e,E[1],r)}function B(e,t,r){e[r.offset++]=t?1:0}function L(e,t,r){t||(t="");let n=S(t,"utf8"),s=0;if(n<32)e[r.offset++]=160|n,s=1;else if(n<256)e[r.offset++]=217,e[r.offset++]=n%255,s=2;else if(n<65536)e[r.offset++]=218,x(e,n,r),s=3;else{if(!(n<4294967296))throw new Error("String too long");e[r.offset++]=219,D(e,n,r),s=5}return T(e,t,r),s+n}function F(e,t,r){return isNaN(t)?F(e,0,r):isFinite(t)?t!==(0|t)?Math.abs(t)<=34028235e31&&(O[0]=t,Math.abs(Math.abs(O[0])-Math.abs(t))<1e-4)?(e[r.offset++]=202,M(e,t,r),5):(e[r.offset++]=203,j(e,t,r),9):t>=0?t<128?(e[r.offset++]=255&t,1):t<256?(e[r.offset++]=204,e[r.offset++]=255&t,2):t<65536?(e[r.offset++]=205,x(e,t,r),3):t<4294967296?(e[r.offset++]=206,D(e,t,r),5):(e[r.offset++]=207,$(e,t,r),9):t>=-32?(e[r.offset++]=224|t+32,1):t>=-128?(e[r.offset++]=208,_(e,t,r),2):t>=-32768?(e[r.offset++]=209,R(e,t,r),3):t>=-2147483648?(e[r.offset++]=210,P(e,t,r),5):(e[r.offset++]=211,k(e,t,r),9):F(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,r)}const V={int8:_,uint8:C,int16:R,uint16:x,int32:P,uint32:D,int64:k,uint64:$,bigint64:N,biguint64:U,float32:M,float64:j,boolean:B,string:L,number:F,utf8Write:T,utf8Length:S},z=new ArrayBuffer(8),W=new Int32Array(z),H=new Float32Array(z),q=new Float64Array(z),J=new BigUint64Array(z),G=new BigInt64Array(z);function K(e,t,r){for(var n="",s=0,i=t.offset,o=t.offset+r;i<o;i++){var a=e[i];128&a?192!=(224&a)?224!=(240&a)?240!=(248&a)?console.error("Invalid byte "+a.toString(16)):(s=(7&a)<<18|(63&e[++i])<<12|(63&e[++i])<<6|63&e[++i])>=65536?(s-=65536,n+=String.fromCharCode(55296+(s>>>10),56320+(1023&s))):n+=String.fromCharCode(s):n+=String.fromCharCode((15&a)<<12|(63&e[++i])<<6|63&e[++i]):n+=String.fromCharCode((31&a)<<6|63&e[++i]):n+=String.fromCharCode(a)}return t.offset+=r,n}function Y(e,t){return X(e,t)<<24>>24}function X(e,t){return e[t.offset++]}function Z(e,t){return Q(e,t)<<16>>16}function Q(e,t){return e[t.offset++]|e[t.offset++]<<8}function ee(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function te(e,t){return ee(e,t)>>>0}function re(e,t){return W[0]=ee(e,t),H[0]}function ne(e,t){return W[0]=ee(e,t),W[1]=ee(e,t),q[0]}function se(e,t){const r=te(e,t);return ee(e,t)*Math.pow(2,32)+r}function ie(e,t){const r=te(e,t);return te(e,t)*Math.pow(2,32)+r}function oe(e,t){return W[0]=ee(e,t),W[1]=ee(e,t),G[0]}function ae(e,t){return W[0]=ee(e,t),W[1]=ee(e,t),J[0]}function ce(e,t){return X(e,t)>0}function he(e,t){const r=e[t.offset++];let n;return r<192?n=31&r:217===r?n=X(e,t):218===r?n=Q(e,t):219===r&&(n=te(e,t)),K(e,t,n)}function le(e,t){const r=e[t.offset++];return r<128?r:202===r?re(e,t):203===r?ne(e,t):204===r?X(e,t):205===r?Q(e,t):206===r?te(e,t):207===r?ie(e,t):208===r?Y(e,t):209===r?Z(e,t):210===r?ee(e,t):211===r?se(e,t):r>223?-1*(255-r+1):void 0}function ue(e,t){const r=e[t.offset];return r<192&&r>160||217===r||218===r||219===r}const fe={utf8Read:K,int8:Y,uint8:X,int16:Z,uint16:Q,int32:ee,uint32:te,float32:re,float64:ne,int64:se,uint64:ie,bigint64:oe,biguint64:ae,boolean:ce,string:he,number:le,stringCheck:ue},de={},pe=new Map;function ge(e,t){t.constructor&&(pe.set(t.constructor,e),de[e]=t),t.encode&&(V[e]=t.encode),t.decode&&(fe[e]=t.decode)}function ye(e){return de[e]}function me(e){for(const t in e)ge(t,e[t]);return e=>Ge(e)}class be{static{this.inheritedTypes=new Map}static{this.cachedContexts=new Map}static register(e){const t=Object.getPrototypeOf(e);if(t!==at){let r=be.inheritedTypes.get(t);r||(r=new Set,be.inheritedTypes.set(t,r)),r.add(e)}}static cache(e){let t=be.cachedContexts.get(e);return t||(t=new be(e),be.cachedContexts.set(e,t)),t}constructor(e){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},e&&this.discoverTypes(e)}has(e){return this.schemas.has(e)}get(e){return this.types[e]}add(e,t=this.schemas.size){return!this.schemas.has(e)&&(this.types[t]=e,void 0===e[Symbol.metadata]&&ve.initialize(e),this.schemas.set(e,t),!0)}getTypeId(e){return this.schemas.get(e)}discoverTypes(e,t,r,n){if(n&&this.registerFilteredByParent(e,t,r),!this.add(e))return;be.inheritedTypes.get(e)?.forEach((e=>{this.discoverTypes(e,t,r,n)}));let s=e;for(;(s=Object.getPrototypeOf(s))&&s!==at&&s!==Function.prototype;)this.discoverTypes(s);const i=e[Symbol.metadata]??={};i[m]&&(this.hasFilters=!0);for(const t in i){const r=t,s=i[r].type,o=void 0!==i[r].tag;if("string"!=typeof s)if(Array.isArray(s)){const t=s[0];if("string"===t)continue;this.discoverTypes(t,e,r,n||o)}else if("function"==typeof s)this.discoverTypes(s,e,r,n||o);else{const t=Object.values(s)[0];if("string"==typeof t)continue;this.discoverTypes(t,e,r,n||o)}}}registerFilteredByParent(e,t,r){let n=`${this.schemas.get(e)??this.schemas.size}`;t&&(n+=`-${this.schemas.get(t)}`),n+=`-${r}`,this.parentFiltered[n]=!0}debug(){let e="";for(const t in this.parentFiltered){const r=t.split("-").map(Number),n=r.pop();e+="\n\t\t",e+=`${t}: ${r.reverse().map(((e,t)=>{const r=this.types[e],s=r[Symbol.metadata];let i=r.name;return 0===t&&(i+=`[${s[n].name}]`),`${i}`})).join(" -> ")}`}return`TypeContext ->\n\tSchema types: ${this.schemas.size}\n\thasFilters: ${this.hasFilters}\n\tparentFiltered:${e}`}}function we(e){return Array.isArray(e)?{array:e[0]}:void 0!==e.type?e.type:e}const ve={addField(e,t,r,n,s){if(t>64)throw new Error(`Can't define field '${r}'.\nSchema instances may only have up to 64 fields.`);e[t]=Object.assign(e[t]||{},{type:we(n),index:t,name:r}),Object.defineProperty(e,p,{value:e[p]||{},enumerable:!1,configurable:!0}),s?(e[p][r]=s,e[p][`_${r}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):e[p][r]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(e,g,{value:t,enumerable:!1,configurable:!0}),Object.defineProperty(e,r,{value:t,enumerable:!1,configurable:!0}),"string"!=typeof e[t].type&&(void 0===e[y]&&Object.defineProperty(e,y,{value:[],enumerable:!1,configurable:!0}),e[y].push(t))},setTag(e,t,r){const n=e[t];e[n].tag=r,e[m]||(Object.defineProperty(e,m,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(e,b,{value:{},enumerable:!1,configurable:!0})),e[m].push(n),e[b][r]||(e[b][r]=[]),e[b][r].push(n)},setFields(e,t){const r=e.prototype.constructor;be.register(r);const n=Object.getPrototypeOf(r),a=n&&n[Symbol.metadata],c=ve.initialize(r);r[s]||(r[s]=at[s]),r[i]||(r[i]=at[i]),r[o]||(r[o]=at[o]),r.prototype.toJSON||(r.prototype.toJSON=at.prototype.toJSON);let h=c[g]??(a&&a[g])??-1;h++;for(const e in t){const r=t[e],n=Array.isArray(r)?ye("array"):"string"==typeof Object.keys(r)[0]&&ye(Object.keys(r)[0]),s=n?Object.values(r)[0]:we(r);ve.addField(c,h,e,r,Ke(`_${e}`,h,s,n)),h++}return e},isDeprecated:(e,t)=>!0===e[t].deprecated,init(e){const t={};e[Symbol.metadata]=t,Object.defineProperty(t,g,{value:0,enumerable:!1,configurable:!0})},initialize(e){const t=Object.getPrototypeOf(e),r=t[Symbol.metadata];let n=e[Symbol.metadata]??Object.create(null);return t!==at&&n===r&&(n=Object.create(null),r&&(Object.setPrototypeOf(n,r),Object.defineProperty(n,g,{value:r[g],enumerable:!1,configurable:!0,writable:!0}),void 0!==r[m]&&(Object.defineProperty(n,m,{value:[...r[m]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(n,b,{value:{...r[b]},enumerable:!1,configurable:!0,writable:!0})),void 0!==r[y]&&Object.defineProperty(n,y,{value:[...r[y]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(n,p,{value:{...r[p]},enumerable:!1,configurable:!0,writable:!0}))),e[Symbol.metadata]=n,n},isValidInstance:e=>e.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(e.constructor[Symbol.metadata],g),getFields(e){const t=e[Symbol.metadata],r={};for(let e=0;e<=t[g];e++)r[t[e].name]=t[e].type;return r},hasViewTagAtIndex:(e,t)=>e?.[m]?.includes(t)};function Ee(){return{indexes:{},operations:[]}}function Oe(e,t){const r=e.indexes[t];void 0===r?e.indexes[t]=e.operations.push(t)-1:e.operations[r]=t}function Ie(e,t){let r=e.indexes[t];void 0===r&&(r=Object.values(e.indexes).at(-1),t=Object.entries(e.indexes).find((([e,t])=>t===r))?.[0]),e.operations[r]=void 0,delete e.indexes[t]}function Ae(e,t,r,n=t[r].queueRootIndex){e&&e[r][n]!==t&&(t[r].queueRootIndex=e[r].push(t)-1)}class Se{constructor(e){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=e;const t=e.constructor[Symbol.metadata];t?.[m]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(e){this.root=e,this.checkIsFiltered(this.parent,this.parentIndex);const t=this.ref.constructor[Symbol.metadata];t?t[y]?.forEach((r=>{const n=t[r],s=this.ref[n.name];s?.[l].setRoot(e)})):this.ref[u]&&"string"!=typeof this.ref[u]&&this.ref.forEach(((t,r)=>{t[l].setRoot(e)}))}setParent(e,t,r){if(this.parent=e,this.parentIndex=r,!t)return;t!==this.root?(this.root=t,this.checkIsFiltered(e,r)):t.add(this);const n=this.ref.constructor[Symbol.metadata];n?n[y]?.forEach((e=>{const r=n[e],s=this.ref[r.name];s?.[l].setParent(this.ref,t,e)})):this.ref[u]&&"string"!=typeof this.ref[u]&&this.ref.forEach(((e,r)=>{e[l].setParent(this.ref,t,this.indexes[r]??r)}))}forEachChild(e){const t=this.ref.constructor[Symbol.metadata];t?t[y]?.forEach((r=>{const n=t[r],s=this.ref[n.name];s&&e(s[l],r)})):this.ref[u]&&"string"!=typeof this.ref[u]&&this.ref.forEach(((t,r)=>{e(t[l],this.indexes[r]??r)}))}operation(e){void 0!==this.filteredChanges?(this.filteredChanges.operations.push(-e),Ae(this.root,this,"filteredChanges")):(this.changes.operations.push(-e),Ae(this.root,this,"changes"))}change(t,r=e.OPERATION.ADD){const n=this.ref.constructor[Symbol.metadata],s=this.isFiltered||void 0!==n?.[t]?.tag,i=s?this.filteredChanges:this.changes,o=this.indexedOperations[t];if(!o||o===e.OPERATION.DELETE){const n=o&&o===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:r;this.indexedOperations[t]=n}Oe(i,t),s?(Oe(this.allFilteredChanges,t),this.root&&(Ae(this.root,this,"filteredChanges"),Ae(this.root,this,"allFilteredChanges"))):(Oe(this.allChanges,t),Ae(this.root,this,"changes"))}shiftChangeIndexes(e){const t=this.isFiltered?this.filteredChanges:this.changes,r={},n={};for(const s in this.indexedOperations)r[Number(s)+e]=this.indexedOperations[s],n[Number(s)+e]=t.indexes[s];this.indexedOperations=r,t.indexes=n,t.operations=t.operations.map((t=>t+e))}shiftAllChangeIndexes(e,t=0){void 0!==this.filteredChanges?(this._shiftAllChangeIndexes(e,t,this.allFilteredChanges),this._shiftAllChangeIndexes(e,t,this.allChanges)):this._shiftAllChangeIndexes(e,t,this.allChanges)}_shiftAllChangeIndexes(e,t=0,r){const n={};let s=0;for(const e in r.indexes)n[s++]=r.indexes[e];r.indexes=n;for(let n=0;n<r.operations.length;n++){const s=r.operations[n];s>t&&(r.operations[n]=s+e)}}indexedOperation(e,t,r=e){this.indexedOperations[e]=t,void 0!==this.filteredChanges?(Oe(this.allFilteredChanges,r),Oe(this.filteredChanges,e),Ae(this.root,this,"filteredChanges")):(Oe(this.allChanges,r),Oe(this.changes,e),Ae(this.root,this,"changes"))}getType(e){return ve.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][e].type:this.ref[u]}getChange(e){return this.indexedOperations[e]}getValue(e,t=!1){return this.ref[c](e,t)}delete(t,r,n=t){if(void 0===t){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${t}'`)}catch(e){console.warn(e)}return}const s=void 0!==this.filteredChanges?this.filteredChanges:this.changes;this.indexedOperations[t]=r??e.OPERATION.DELETE,Oe(s,t),Ie(this.allChanges,n);const i=this.getValue(t);return i&&i[l]&&this.root?.remove(i[l]),void 0!==this.filteredChanges?(Ie(this.allFilteredChanges,n),Ae(this.root,this,"filteredChanges")):Ae(this.root,this,"changes"),i}endEncode(e){this.indexedOperations={},this[e].indexes={},this[e].operations.length=0,this[e].queueRootIndex=void 0,this.ref[f]?.(),this.isNew=!1}discard(e=!1){this.ref[f]?.(),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,void 0!==this.filteredChanges&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),e&&(this.allChanges.indexes={},this.allChanges.operations.length=0,void 0!==this.allFilteredChanges&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild(((e,t)=>this.root?.remove(e))))}discardAll(){const e=Object.keys(this.indexedOperations);for(let t=0,r=e.length;t<r;t++){const r=this.getValue(Number(e[t]));r&&r[l]&&r[l].discardAll()}this.discard()}ensureRefId(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(e,t){const r=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(e,t),void 0!==this.filteredChanges&&(Ae(this.root,this,"filteredChanges"),r&&this.root.allFilteredChanges.push(this))),this.isFiltered||(Ae(this.root,this,"changes"),r&&this.root.allChanges.push(this))}_checkFilteredByParent(e,t){if(!e)return;const r=ve.isValidInstance(this.ref)?this.ref.constructor:this.ref[u];let n,s=!ve.isValidInstance(e);s?(n=e[l],e=n.parent,t=n.parentIndex):n=e[l];const i=e.constructor;let o=`${this.root.types.getTypeId(r)}`;i&&(o+=`-${this.root.types.schemas.get(i)}`),o+=`-${t}`;const a=ve.hasViewTagAtIndex(i?.[Symbol.metadata],t);this.isFiltered=e[l].isFiltered||this.root.types.parentFiltered[o]||a,this.isFiltered&&(this.isVisibilitySharedWithParent=n.isFiltered&&"string"!=typeof r&&!a&&s,this.filteredChanges||(this.filteredChanges=Ee(),this.allFilteredChanges=Ee()),this.changes.operations.length>0&&(this.changes.operations.forEach((e=>Oe(this.filteredChanges,e))),this.allChanges.operations.forEach((e=>Oe(this.allFilteredChanges,e))),this.changes=Ee(),this.allChanges=Ee()))}}function Te(t,r,n,s,i,o){"string"==typeof n?V[n]?.(r,s,o):void 0!==n[Symbol.metadata]?(V.number(r,s[l].refId,o),(i&e.OPERATION.ADD)===e.OPERATION.ADD&&t.tryEncodeTypeId(r,n,s.constructor,o)):V.number(r,s[l].refId,o)}const _e=function(t,r,n,s,i,o,a,c,h){if(r[o.offset++]=255&(s|i),i===e.OPERATION.DELETE)return;const l=n.ref,u=h[s];Te(t,r,h[s].type,l[u.name],i,o)},Ce=function(t,r,n,s,i,o){if(r[o.offset++]=255&i,i===e.OPERATION.CLEAR)return;if(V.number(r,s,o),i===e.OPERATION.DELETE)return;const a=n.ref;if((i&e.OPERATION.ADD)===e.OPERATION.ADD&&"function"==typeof a.set){const e=n.ref.$indexes.get(s);V.string(r,e,o)}Te(t,r,a[u],a[c](s),i,o)},Re=function(t,r,n,s,i,o,a,c){const h=n.ref;let u;c&&n.isFiltered&&"string"!=typeof n.getType(s)?(u=h.tmpItems[s][l].refId,i===e.OPERATION.DELETE?i=e.OPERATION.DELETE_BY_REFID:i===e.OPERATION.ADD&&(i=e.OPERATION.ADD_BY_REFID)):u=s,r[o.offset++]=255&i,i!==e.OPERATION.CLEAR&&i!==e.OPERATION.REVERSE&&(V.number(r,u,o),i!==e.OPERATION.DELETE&&i!==e.OPERATION.DELETE_BY_REFID&&Te(t,r,n.getType(s),n.getValue(s,a),i,o))},xe=-1;function Pe(t,r,n,s,i,o,a,l){const f=t.root,d=n[c](s);let p;if((r&e.OPERATION.DELETE)===e.OPERATION.DELETE){const t=f.refIds.get(d);void 0!==t&&f.removeRef(t),r!==e.OPERATION.DELETE_AND_ADD&&n[h](s),p=void 0}if(r===e.OPERATION.DELETE);else if(at.is(i)){const n=fe.number(o,a);if(p=f.refs.get(n),(r&e.OPERATION.ADD)===e.OPERATION.ADD){const s=t.getInstanceType(o,a,i);p||(p=t.createInstanceOfType(s)),f.addRef(n,p,p!==d||r===e.OPERATION.DELETE_AND_ADD&&p===d)}}else if("string"==typeof i)p=fe[i](o,a);else{const t=ye(Object.keys(i)[0]),n=fe.number(o,a),s=f.refs.has(n)?d||f.refs.get(n):new t.constructor;if(p=s.clone(!0),p[u]=Object.values(i)[0],d){let t=f.refIds.get(d);if(void 0!==t&&n!==t){const r=d.entries();let n;for(;(n=r.next())&&!n.done;){const[r,s]=n.value;"object"==typeof s&&(t=f.refIds.get(s),f.removeRef(t)),l.push({ref:d,refId:t,op:e.OPERATION.DELETE,field:r,value:void 0,previousValue:s})}}}f.addRef(n,p,s!==d||r===e.OPERATION.DELETE_AND_ADD&&s===d)}return{value:p,previousValue:d}}const De=function(e,t,r,n,s){const i=t[r.offset++],o=n.constructor[Symbol.metadata],a=i>>6<<6,c=i%(a||255),h=o[c];if(void 0===h)return console.warn("@colyseus/schema: field not defined at",{index:c,ref:n.constructor.name,metadata:o}),xe;const{value:l,previousValue:u}=Pe(e,a,n,c,h.type,t,r,s);null!=l&&(n[h.name]=l),u!==l&&s.push({ref:n,refId:e.currentRefId,op:a,field:h.name,value:l,previousValue:u})},ke=function(t,r,n,s,i){const o=r[n.offset++];if(o===e.OPERATION.CLEAR)return t.removeChildRefs(s,i),void s.clear();const a=fe.number(r,n),c=s[u];let h;(o&e.OPERATION.ADD)===e.OPERATION.ADD?"function"==typeof s.set?(h=fe.string(r,n),s.setIndex(a,h)):h=a:h=s.getIndex(a);const{value:l,previousValue:f}=Pe(t,o,s,a,c,r,n,i);if(null!=l)if("function"==typeof s.set)s.$items.set(h,l);else if("function"==typeof s.$setAt)s.$setAt(a,l,o);else if("function"==typeof s.add){const e=s.add(l);"number"==typeof e&&s.setIndex(e,e)}f!==l&&i.push({ref:s,refId:t.currentRefId,op:o,field:"",dynamicIndex:h,value:l,previousValue:f})},$e=function(t,r,n,s,i){let o,a=r[n.offset++];if(a===e.OPERATION.CLEAR)return t.removeChildRefs(s,i),void s.clear();if(a===e.OPERATION.REVERSE)return void s.reverse();if(a===e.OPERATION.DELETE_BY_REFID){const a=fe.number(r,n),c=t.root.refs.get(a);return o=s.findIndex((e=>e===c)),s[h](o),void i.push({ref:s,refId:t.currentRefId,op:e.OPERATION.DELETE,field:"",dynamicIndex:o,value:void 0,previousValue:c})}if(a===e.OPERATION.ADD_BY_REFID){const e=fe.number(r,n),i=t.root.refs.get(e);i&&(o=s.findIndex((e=>e===i))),-1!==o&&void 0!==o||(o=s.length)}else o=fe.number(r,n);const c=s[u];let l=o;const{value:f,previousValue:d}=Pe(t,a,s,o,c,r,n,i);null!=f&&f!==d&&s.$setAt(o,f,a),d!==f&&i.push({ref:s,refId:t.currentRefId,op:a,field:"",dynamicIndex:l,value:f,previousValue:d})};class Ne extends Error{}function Ue(e,t,r,n){let s,i=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":s="number",isNaN(e)&&console.log(`trying to encode "NaN" in ${r.constructor.name}#${n}`);break;case"bigint64":case"biguint64":s="bigint";break;case"string":s="string",i=!0;break;default:return}if(typeof e!==s&&(!i||i&&null!==e)){let t=`'${JSON.stringify(e)}'${e&&e.constructor&&` (${e.constructor.name})`||""}`;throw new Ne(`a '${s}' was expected, but ${t} was provided in ${r.constructor.name}#${n}`)}}function Me(e,t,r,n){if(!(e instanceof t))throw new Ne(`a '${t.name}' was expected, but '${e&&e.constructor.name}' was provided in ${r.constructor.name}#${n}`)}var je,Be;const Le=(e,t)=>{const r=e.toString(),n=t.toString();return r<n?-1:r>n?1:0};class Fe{static{this[je]=Re}static{this[Be]=$e}static[(je=i,Be=o,a)](e,t,r){return!r||"string"==typeof e[u]||r.isChangeTreeVisible(e.tmpItems[t]?.[l])}static is(e){return Array.isArray(e)||void 0!==e.array}static from(e){return new Fe(...Array.from(e))}constructor(...t){this.items=[],this.tmpItems=[],this.deletedIndexes={},this.isMovingItems=!1,Object.defineProperty(this,u,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const r=new Proxy(this,{get:(e,t)=>"symbol"==typeof t||isNaN(t)?Reflect.get(e,t):this.items[t],set:(t,r,n)=>{if("symbol"==typeof r||isNaN(r))return Reflect.set(t,r,n);if(null==n)t.$deleteAt(r);else{if(n[l]){Me(n,t[u],t,r);const s=t.items[r];t.isMovingItems?(void 0!==s?n[l].isNew?t[l].indexedOperation(Number(r),e.OPERATION.MOVE_AND_ADD):(t[l].getChange(Number(r))&e.OPERATION.DELETE)===e.OPERATION.DELETE?t[l].indexedOperation(Number(r),e.OPERATION.DELETE_AND_MOVE):t[l].indexedOperation(Number(r),e.OPERATION.MOVE):n[l].isNew&&t[l].indexedOperation(Number(r),e.OPERATION.ADD),n[l].setParent(this,t[l].root,r)):t.$changeAt(Number(r),n),void 0!==s&&s[l].root?.remove(s[l])}else t.$changeAt(Number(r),n);t.items[r]=n,t.tmpItems[r]=n}return!0},deleteProperty:(e,t)=>("number"==typeof t?e.$deleteAt(t):delete e[t],!0),has:(e,t)=>"symbol"==typeof t||isNaN(Number(t))?Reflect.has(e,t):Reflect.has(this.items,t)});return this[l]=new Se(r),this[l].indexes={},t.length>0&&this.push(...t),r}set length(e){0===e?this.clear():e<this.items.length?this.splice(e,this.length-e):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...t){let r=this.tmpItems.length;const n=this[l];let s=0;for(t.length;s<t.length;s++,r++){const i=t[s];if(null==i)return;"object"==typeof i&&this[u]&&Me(i,this[u],this,s),n.indexedOperation(r,e.OPERATION.ADD,this.items.length),this.items.push(i),this.tmpItems.push(i),i[l]?.setParent(this,n.root,r)}return r}pop(){let e=-1;for(let t=this.tmpItems.length-1;t>=0;t--)if(!0!==this.deletedIndexes[t]){e=t;break}if(!(e<0))return this[l].delete(e,void 0,this.items.length-1),this.deletedIndexes[e]=!0,this.items.pop()}at(e){return e<0&&(e+=this.length),this.items[e]}$changeAt(t,r){if(null==r)return void console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");if(this.items[t]===r)return;const n=void 0!==this.items[t]?"object"==typeof r?e.OPERATION.DELETE_AND_ADD:e.OPERATION.REPLACE:e.OPERATION.ADD,s=this[l];s.change(t,n),r[l]?.setParent(this,s.root,t)}$deleteAt(e,t){this[l].delete(e,t)}$setAt(t,r,n){0===t&&n===e.OPERATION.ADD&&void 0!==this.items[t]?this.items.unshift(r):n===e.OPERATION.DELETE_AND_MOVE?(this.items.splice(t,1),this.items[t]=r):this.items[t]=r}clear(){if(0===this.items.length)return;const t=this[l];t.forEachChild(((e,t)=>{e.discard(!0);const r=e.root;void 0!==r&&(r.removeChangeFromChangeSet("changes",e),r.removeChangeFromChangeSet("allChanges",e),r.removeChangeFromChangeSet("allFilteredChanges",e))})),t.discard(!0),t.operation(e.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...e){return new Fe(...this.items.concat(...e))}join(e){return this.items.join(e)}reverse(){return this[l].operation(e.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(0===this.items.length)return;const t=this[l],r=this.tmpItems.findIndex((e=>e===this.items[0])),n=this.items.findIndex((e=>e===this.items[0]));return t.delete(r,e.OPERATION.DELETE,n),t.shiftAllChangeIndexes(-1,n),this.items.shift()}slice(e,t){const r=new Fe;return r.push(...this.items.slice(e,t)),r}sort(t=Le){this.isMovingItems=!0;const r=this[l];return this.items.sort(t).forEach(((t,n)=>r.change(n,e.OPERATION.REPLACE))),this.tmpItems.sort(t),this.isMovingItems=!1,this}splice(t,r,...n){const s=this[l],i=this.items.length,o=this.tmpItems.length,a=n.length,c=[];for(let e=0;e<o;e++)!0!==this.deletedIndexes[e]&&c.push(e);if(i>t){void 0===r&&(r=i-t);for(let n=t;n<t+r;n++){const t=c[n];s.delete(t,e.OPERATION.DELETE),this.deletedIndexes[t]=!0}}else r=0;if(a>0){if(a>r)throw console.error("Inserting more elements than deleting during ArraySchema#splice()"),new Error("ArraySchema#splice(): insertCount must be equal or lower than deleteCount.");for(let r=0;r<a;r++){const o=(c[t]??i)+r;s.indexedOperation(o,this.deletedIndexes[o]?e.OPERATION.DELETE_AND_ADD:e.OPERATION.ADD),n[r][l]?.setParent(this,s.root,o)}}return r>a&&s.shiftAllChangeIndexes(-(r-a),c[t+a]),void 0!==s.filteredChanges?Ae(s.root,s,"filteredChanges"):Ae(s.root,s,"changes"),this.items.splice(t,r,...n)}unshift(...t){const r=this[l];return r.shiftChangeIndexes(t.length),r.isFiltered?Oe(r.filteredChanges,this.items.length):Oe(r.allChanges,this.items.length),t.forEach(((t,n)=>{r.change(n,e.OPERATION.ADD)})),this.tmpItems.unshift(...t),this.items.unshift(...t)}indexOf(e,t){return this.items.indexOf(e,t)}lastIndexOf(e,t=this.length-1){return this.items.lastIndexOf(e,t)}every(e,t){return this.items.every(e,t)}some(e,t){return this.items.some(e,t)}forEach(e,t){return this.items.forEach(e,t)}map(e,t){return this.items.map(e,t)}filter(e,t){return this.items.filter(e,t)}reduce(e,t){return this.items.reduce(e,t)}reduceRight(e,t){return this.items.reduceRight(e,t)}find(e,t){return this.items.find(e,t)}findIndex(e,t){return this.items.findIndex(e,t)}fill(e,t,r){throw new Error("ArraySchema#fill() not implemented")}copyWithin(e,t,r){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return Fe}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(e,t){return this.items.includes(e,t)}flatMap(e,t){throw new Error("ArraySchema#flatMap() is not supported.")}flat(e){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...e){return this.items.findLastIndex.apply(this.items,arguments)}with(e,t){const r=this.items.slice();return e<0&&(e+=this.length),r[e]=t,new Fe(...r)}toReversed(){return this.items.slice().reverse()}toSorted(e){return this.items.slice().sort(e)}toSpliced(e,t,...r){return this.items.toSpliced.apply(copy,arguments)}shuffle(){return this.move((e=>{let t=this.items.length;for(;0!=t;){let e=Math.floor(Math.random()*t);t--,[this[t],this[e]]=[this[e],this[t]]}}))}move(e){return this.isMovingItems=!0,e(this),this.isMovingItems=!1,this}[c](e,t=!1){return t||this.deletedIndexes[e]?this.items[e]:this.tmpItems[e]||this.items[e]}[h](e){this.items[e]=void 0,this.tmpItems[e]=void 0}[f](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[d](){this.items=this.items.filter((e=>void 0!==e)),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map((e=>"function"==typeof e.toJSON?e.toJSON():e))}clone(e){let t;return e?(t=new Fe,t.push(...this.items)):t=new Fe(...this.map((e=>e[l]?e.clone():e))),t}}var Ve,ze;ge("array",{constructor:Fe});class We{static{this[Ve]=Ce}static{this[ze]=ke}static[(Ve=i,ze=o,a)](e,t,r){return!r||"string"==typeof e[u]||r.isChangeTreeVisible((e[c](t)??e.deletedItems[t])[l])}static is(e){return void 0!==e.map}constructor(e){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[l]=new Se(this),this[l].indexes={},e)if(e instanceof Map||e instanceof We)e.forEach(((e,t)=>this.set(t,e)));else for(const t in e)this.set(t,e[t]);Object.defineProperty(this,u,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return We}set(t,r){if(null==r)throw new Error(`MapSchema#set('${t}', ${r}): trying to set ${r} value on '${t}'.`);"object"==typeof r&&this[u]&&Me(r,this[u],this,t),t=t.toString();const n=this[l],s=void 0!==r[l];let i,o;if(void 0!==n.indexes[t]){i=n.indexes[t],o=e.OPERATION.REPLACE;const a=this.$items.get(t);if(a===r)return;s&&(o=e.OPERATION.DELETE_AND_ADD,void 0!==a&&a[l].root?.remove(a[l]))}else i=n.indexes[g]??0,o=e.OPERATION.ADD,this.$indexes.set(i,t),n.indexes[t]=i,n.indexes[g]=i+1;return this.$items.set(t,r),n.change(i,o),s&&r[l].setParent(this,n.root,i),this}get(e){return this.$items.get(e)}delete(e){const t=this[l].indexes[e];return this.deletedItems[t]=this[l].delete(t),this.$items.delete(e)}clear(){const t=this[l];t.discard(!0),t.indexes={},this.$indexes.clear(),this.$items.clear(),t.operation(e.OPERATION.CLEAR)}has(e){return this.$items.has(e)}forEach(e){this.$items.forEach(e)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(e,t){this.$indexes.set(e,t)}getIndex(e){return this.$indexes.get(e)}[c](e){return this.$items.get(this.$indexes.get(e))}[h](e){const t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)}[f](){this.deletedItems={}}toJSON(){const e={};return this.forEach(((t,r)=>{e[r]="function"==typeof t.toJSON?t.toJSON():t})),e}clone(e){let t;return e?t=Object.assign(new We,this):(t=new We,this.forEach(((e,r)=>{e[l]?t.set(r,e.clone()):t.set(r,e)}))),t}}ge("map",{constructor:We});const He=-1;function qe(e){return be.register(e),e}function Je(e=He){return function(t,r){const n=t.constructor,s=Object.getPrototypeOf(n)[Symbol.metadata],i=n[Symbol.metadata]??=Object.assign({},n[Symbol.metadata],s??Object.create(null));ve.setTag(i,r,e)}}function Ge(e,t){return function(r,n){const s=r.constructor;if(!e)throw new Error(`${s.name}: @type() reference provided for "${n}" is undefined. Make sure you don't have any circular dependencies.`);be.register(s);const i=Object.getPrototypeOf(s)[Symbol.metadata],o=ve.initialize(s);let a=o[n];if(void 0!==o[a]){if(o[a].deprecated)return;if(void 0!==o[a].type)try{throw new Error(`@colyseus/schema: Duplicate '${n}' definition on '${s.name}'.\nCheck @type() annotation`)}catch(e){const t=e.stack.split("\n")[4].trim();throw new Error(`${e.message} ${t}`)}}else a=o[g]??(i&&i[g])??-1,a++;if(t&&t.manual)ve.addField(o,a,n,e,{enumerable:!0,configurable:!0,writable:!0});else{const t=Array.isArray(e)?ye("array"):"string"==typeof Object.keys(e)[0]&&ye(Object.keys(e)[0]),r=t?Object.values(e)[0]:e;ve.addField(o,a,n,e,Ke(`_${n}`,a,r,t))}}}function Ke(t,r,n,i){return{get:function(){return this[t]},set:function(o){const a=this[t]??void 0;if(o!==a){if(null!=o){i?(i.constructor!==Fe||o instanceof Fe||(o=new Fe(...o)),i.constructor!==We||o instanceof We||(o=new We(o)),o[u]=n):"string"!=typeof n?Me(o,n,this,t.substring(1)):Ue(o,n,this,t.substring(1));const c=this[l];void 0!==a&&a[l]?(c.root?.remove(a[l]),this.constructor[s](c,r,e.OPERATION.DELETE_AND_ADD)):this.constructor[s](c,r,e.OPERATION.ADD),o[l]?.setParent(this,c.root,r)}else void 0!==a&&this[l].delete(r);this[t]=o}},enumerable:!0,configurable:!0}}function Ye(e=!0){return function(t,r){const n=t.constructor,s=Object.getPrototypeOf(n)[Symbol.metadata],i=n[Symbol.metadata]??=Object.assign({},n[Symbol.metadata],s??Object.create(null)),o=i[r];i[o].deprecated=!0,e&&(i[p]??={},i[p][r]={get:function(){throw new Error(`${r} is deprecated.`)},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(i,o,{value:i[o],enumerable:!1,configurable:!0})}}function Xe(e,t,r){for(let n in t)Ge(t[n],r)(e.prototype,n);return e}function Ze(e,t,r=at){const n={},s={};for(let t in e){const r=e[t];"object"==typeof r&&(void 0!==r.default&&(n[t]=r.default),void 0!==r.view&&(s[t]="boolean"==typeof r.view?He:r.view))}const i=ve.setFields(class extends r{constructor(...e){e[0]=Object.assign({},n,e[0]),super(...e)}},e);for(let e in s)Je(s[e])(i.prototype,e);return t&&Object.defineProperty(i,"name",{value:t}),i.extends=(e,t)=>Ze(e,t,i),i}function Qe(e){return new Array(e).fill(0).map(((t,r)=>r===e-1?"└─ ":"   ")).join("")}function et(t){const r=t[l].root,n={ops:{},refs:[]};return r.changes.forEach((t=>{if(void 0===t)return;const r=t.indexedOperations;n.refs.push(`refId#${t.refId}`);for(const t in r){const s=r[t],i=e.OPERATION[s];n.ops[i]||(n.ops[i]=0),n.ops[e.OPERATION[s]]++}})),n}var tt,rt,nt,st,it,ot;class at{static{this[tt]=_e}static{this[rt]=De}static initialize(e){Object.defineProperty(e,l,{value:new Se(e),enumerable:!1,writable:!0}),Object.defineProperties(e,e.constructor[Symbol.metadata]?.[p]||{})}static is(e){return"object"==typeof e[Symbol.metadata]}static[(tt=i,rt=o,s)](t,r,n=e.OPERATION.ADD){t.change(r,n)}static[a](e,t,r){const n=e.constructor[Symbol.metadata],s=n[t]?.tag;if(void 0===r)return void 0===s;if(void 0===s)return!0;if(s===He)return r.isChangeTreeVisible(e[l]);{const t=r.tags?.get(e[l]);return t&&t.has(s)}}constructor(...e){at.initialize(this),e[0]&&Object.assign(this,e[0])}assign(e){return Object.assign(this,e),this}setDirty(e,t){const r=this.constructor[Symbol.metadata];this[l].change(r[r[e]].index,t)}clone(){const e=new this.constructor,t=this.constructor[Symbol.metadata];for(const r in t){const n=t[r].name;"object"==typeof this[n]&&"function"==typeof this[n]?.clone?e[n]=this[n].clone():e[n]=this[n]}return e}toJSON(){const e={},t=this.constructor[Symbol.metadata];for(const r in t){const n=t[r],s=n.name;n.deprecated||null===this[s]||void 0===this[s]||(e[s]="function"==typeof this[s].toJSON?this[s].toJSON():this[s])}return e}discardAllChanges(){this[l].discardAll()}[c](e){return this[this.constructor[Symbol.metadata][e].name]}[h](e){this[this.constructor[Symbol.metadata][e].name]=void 0}static debugRefIds(e,t=!1,r=0){const n=t?` - ${JSON.stringify(e.toJSON())}`:"",s=e[l],i=s.refId;let o="";return o+=`${Qe(r)}${e.constructor.name} (refId: ${i})${n}\n`,s.forEachChild((e=>o+=this.debugRefIds(e.ref,t,r+1))),o}static debugChanges(t,r=!1){const n=t[l],s=r?n.allChanges:n.changes,i=r?"allChanges":"changes";let o=`${t.constructor.name} (${n.refId}) -> .${i}:\n`;function a(t){t.operations.filter((e=>e)).forEach((t=>{const s=n.indexedOperations[t];console.log({index:t,operation:s}),o+=`- [${t}]: ${e.OPERATION[s]} (${JSON.stringify(n.getValue(Number(t),r))})\n`}))}return a(s),!r&&n.filteredChanges&&n.filteredChanges.operations.filter((e=>e)).length>0&&(o+=`${t.constructor.name} (${n.refId}) -> .filteredChanges:\n`,a(n.filteredChanges)),r&&n.allFilteredChanges&&n.allFilteredChanges.operations.filter((e=>e)).length>0&&(o+=`${t.constructor.name} (${n.refId}) -> .allFilteredChanges:\n`,a(n.allFilteredChanges)),o}static debugChangesDeep(t,r="changes"){let n="";const s=t[l],i=s.root,o=new Map,a=[];let c=0;for(const[e,n]of Object.entries(i[r])){const r=i.changeTrees[e];let h=!1,u=[],f=r.parent?.[l];if(r===s)h=!0;else for(;void 0!==f;){if(u.push(f),f.ref===t){h=!0;break}f=f.parent?.[l]}h&&(a.push(r.refId),c+=Object.keys(n).length,o.set(r,u.reverse()))}n+="---\n",n+=`root refId: ${s.refId}\n`,n+=`Total instances: ${a.length} (refIds: ${a.join(", ")})\n`,n+=`Total changes: ${c}\n`,n+="---\n";const h=new WeakSet;for(const[t,r]of o.entries()){r.forEach(((e,t)=>{h.has(e)||(n+=`${Qe(t)}${e.ref.constructor.name} (refId: ${e.refId})\n`,h.add(e))}));const s=t.indexedOperations,i=r.length,o=Qe(i),a=i>0?`(${t.parentIndex}) `:"";n+=`${o}${a}${t.ref.constructor.name} (refId: ${t.refId}) - changes: ${Object.keys(s).length}\n`;for(const t in s){const r=s[t];n+=`${Qe(i+1)}${e.OPERATION[r]}: ${t}\n`}}return`${n}`}}class ct{static{this[nt]=Ce}static{this[st]=ke}static[(nt=i,st=o,a)](e,t,r){return!r||"string"==typeof e[u]||r.isChangeTreeVisible((e[c](t)??e.deletedItems[t])[l])}static is(e){return void 0!==e.collection}constructor(e){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[l]=new Se(this),this[l].indexes={},e&&e.forEach((e=>this.add(e))),Object.defineProperty(this,u,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(e){const t=this.$refId++;return void 0!==e[l]&&e[l].setParent(this,this[l].root,t),this[l].indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this[l].change(t),t}at(e){const t=Array.from(this.$items.keys())[e];return this.$items.get(t)}entries(){return this.$items.entries()}delete(e){const t=this.$items.entries();let r,n;for(;(n=t.next())&&!n.done;)if(e===n.value[1]){r=n.value[0];break}return void 0!==r&&(this.deletedItems[r]=this[l].delete(r),this.$indexes.delete(r),this.$items.delete(r))}clear(){const t=this[l];t.discard(!0),t.indexes={},this.$indexes.clear(),this.$items.clear(),t.operation(e.OPERATION.CLEAR)}has(e){return Array.from(this.$items.values()).some((t=>t===e))}forEach(e){this.$items.forEach(((t,r,n)=>e(t,r,this)))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(e,t){this.$indexes.set(e,t)}getIndex(e){return this.$indexes.get(e)}[c](e){return this.$items.get(this.$indexes.get(e))}[h](e){const t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)}[f](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const e=[];return this.forEach(((t,r)=>{e.push("function"==typeof t.toJSON?t.toJSON():t)})),e}clone(e){let t;return e?t=Object.assign(new ct,this):(t=new ct,this.forEach((e=>{e[l]?t.add(e.clone()):t.add(e)}))),t}}ge("collection",{constructor:ct});class ht{static{this[it]=Ce}static{this[ot]=ke}static[(it=i,ot=o,a)](e,t,r){return!r||"string"==typeof e[u]||r.visible.has((e[c](t)??e.deletedItems[t])[l])}static is(e){return void 0!==e.set}constructor(e){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[l]=new Se(this),this[l].indexes={},e&&e.forEach((e=>this.add(e))),Object.defineProperty(this,u,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(t){if(this.has(t))return!1;const r=this.$refId++;void 0!==t[l]&&t[l].setParent(this,this[l].root,r);const n=this[l].indexes[r]?.op??e.OPERATION.ADD;return this[l].indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,t),this[l].change(r,n),r}entries(){return this.$items.entries()}delete(e){const t=this.$items.entries();let r,n;for(;(n=t.next())&&!n.done;)if(e===n.value[1]){r=n.value[0];break}return void 0!==r&&(this.deletedItems[r]=this[l].delete(r),this.$indexes.delete(r),this.$items.delete(r))}clear(){const t=this[l];t.discard(!0),t.indexes={},this.$indexes.clear(),this.$items.clear(),t.operation(e.OPERATION.CLEAR)}has(e){const t=this.$items.values();let r,n=!1;for(;(r=t.next())&&!r.done;)if(e===r.value){n=!0;break}return n}forEach(e){this.$items.forEach(((t,r,n)=>e(t,r,this)))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(e,t){this.$indexes.set(e,t)}getIndex(e){return this.$indexes.get(e)}[c](e){return this.$items.get(this.$indexes.get(e))}[h](e){const t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)}[f](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const e=[];return this.forEach(((t,r)=>{e.push("function"==typeof t.toJSON?t.toJSON():t)})),e}clone(e){let t;return e?t=Object.assign(new ht,this):(t=new ht,this.forEach((e=>{e[l]?t.add(e.clone()):t.add(e)}))),t}}function lt(e,t,r,n){var s,i=arguments.length,o=i<3?t:n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}ge("set",{constructor:ht}),"function"==typeof SuppressedError&&SuppressedError;class ut{constructor(e){this.types=e,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(t){t.ensureRefId();const r=void 0===this.changeTrees[t.refId];r&&(this.changeTrees[t.refId]=t);const n=this.refCount[t.refId];if(0===n){const r=t.allChanges.operations;let n=r.length;for(;n--;)t.indexedOperations[r[n]]=e.OPERATION.ADD,Oe(t.changes,n)}return this.refCount[t.refId]=(n||0)+1,r}remove(e){const t=this.refCount[e.refId]-1;return t<=0?(e.root=void 0,delete this.changeTrees[e.refId],this.removeChangeFromChangeSet("allChanges",e),this.removeChangeFromChangeSet("changes",e),e.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",e),this.removeChangeFromChangeSet("filteredChanges",e)),this.refCount[e.refId]=0):(this.refCount[e.refId]=t,void 0!==e.filteredChanges?(this.removeChangeFromChangeSet("filteredChanges",e),Ae(this,e,"filteredChanges")):(this.removeChangeFromChangeSet("changes",e),Ae(this,e,"changes"))),e.forEachChild(((e,t)=>this.remove(e))),t}removeChangeFromChangeSet(e,t){const r=this[e],n=r.indexOf(t);if(-1!==n)return t[e].queueRootIndex=-1,r[n]=void 0,!0}clear(){this.changes.length=0}}class ft{static{this.BUFFER_SIZE="undefined"!=typeof Buffer&&Buffer.poolSize||8192}constructor(e){this.sharedBuffer=Buffer.allocUnsafe(ft.BUFFER_SIZE),this.context=be.cache(e.constructor),this.root=new ut(this.context),this.setState(e)}setState(e){this.state=e,this.state[l].setRoot(this.root)}encode(r={offset:0},n,s=this.sharedBuffer,o="changes",c="allChanges"===o,h=r.offset){const u=void 0!==n,f=this.state[l],d=this.root[o];for(let l=0,p=d.length;l<p;l++){const p=d[l];if(!p)continue;if(u){if(!n.isChangeTreeVisible(p)){n.invisible.add(p);continue}n.invisible.delete(p)}const g=p[o],y=p.ref,m=g.operations.length;if(0===m)continue;const b=y.constructor,w=b[i],v=b[a],E=b[Symbol.metadata];(u||r.offset>h||p!==f)&&(s[r.offset++]=255&t,V.number(s,p.refId,r));for(let t=0;t<m;t++){const i=g.operations[t],o=i<0?Math.abs(i):c?e.OPERATION.ADD:p.indexedOperations[i];void 0===i||void 0===o||v&&!v(y,i,n)||w(this,s,p,i,o,r,c,u,E)}}if(r.offset>s.byteLength){const e=Math.ceil(r.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:\n\n    import { Encoder } from "@colyseus/schema";\n    Encoder.BUFFER_SIZE = ${Math.round(e/1024)} * 1024; // ${Math.round(e/1024)} KB\n`),(s=Buffer.alloc(e,s))===this.sharedBuffer&&(this.sharedBuffer=s),this.encode({offset:h},n,s,o,c)}return s.subarray(0,r.offset)}encodeAll(e={offset:0},t=this.sharedBuffer){return this.encode(e,void 0,t,"allChanges",!0)}encodeAllView(e,t,r,n=this.sharedBuffer){const s=r.offset;return this.encode(r,e,n,"allFilteredChanges",!0,s),Buffer.concat([n.subarray(0,t),n.subarray(s,r.offset)])}debugChanges(t){("string"==typeof t?this.root[t]:t).forEach((r=>{const n=r[t],s=r.ref.constructor[Symbol.metadata];console.log("->",{ref:r.ref.constructor.name,refId:r.refId,changes:Object.keys(n).length});for(const t in n){const r=n[t];console.log("  ->",{index:t,field:s?.[t],op:e.OPERATION[r]})}}))}encodeView(r,n,s,o=this.sharedBuffer){const a=s.offset;for(const[n,a]of r.changes){const h=this.root.changeTrees[n];if(void 0===h){r.changes.delete(n);continue}const l=Object.keys(a);if(0===l.length)continue;const u=h.ref.constructor,f=u[i],d=u[Symbol.metadata];o[s.offset++]=255&t,V.number(o,h.refId,s);for(let t=0,r=l.length;t<r;t++){const r=Number(l[t]),n=h.ref[c](r);f(this,o,h,r,void 0!==n&&a[r]||e.OPERATION.DELETE,s,!1,!0,d)}}return r.changes.clear(),this.encode(s,r,o,"filteredChanges",!1,a),Buffer.concat([o.subarray(0,n),o.subarray(a,s.offset)])}discardChanges(){let e=this.root.changes.length;if(e>0){for(;e--;)this.root.changes[e]?.endEncode("changes");this.root.changes.length=0}if(e=this.root.filteredChanges.length,e>0){for(;e--;)this.root.filteredChanges[e]?.endEncode("filteredChanges");this.root.filteredChanges.length=0}}tryEncodeTypeId(e,t,n,s){const i=this.context.getTypeId(t),o=this.context.getTypeId(n);void 0!==o?i!==o&&(e[s.offset++]=255&r,V.number(e,o,s)):console.warn(`@colyseus/schema WARNING: Class "${n.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`)}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}}function dt(e,t){if(-1===t||t>=e.length)return!1;const r=e.length-1;for(let n=t;n<r;n++)e[n]=e[n+1];return e.length=r,!0}class pt extends Error{constructor(e){super(e),this.name="DecodingWarning"}}class gt{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(e,t,r=!0){this.refs.set(e,t),this.refIds.set(t,e),r&&(this.refCounts[e]=(this.refCounts[e]||0)+1),this.deletedRefs.has(e)&&this.deletedRefs.delete(e)}removeRef(e){const t=this.refCounts[e];if(void 0!==t)if(0!==t)(this.refCounts[e]=t-1)<=0&&this.deletedRefs.add(e);else try{const t=this.refs.get(e);throw new pt(`trying to remove refId '${e}' with 0 refCount (${t.constructor.name}: ${JSON.stringify(t)})`)}catch(e){console.warn(e)}else try{throw new pt("trying to remove refId that doesn't exist: "+e)}catch(e){console.warn(e)}}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach((e=>{if(this.refCounts[e]>0)return;const t=this.refs.get(e);if(void 0!==t.constructor[Symbol.metadata]){const e=t.constructor[Symbol.metadata];for(const r in e){const n=e[r].name,s="object"==typeof t[n]&&this.refIds.get(t[n]);s&&!this.deletedRefs.has(s)&&this.removeRef(s)}}else"function"==typeof t[u]&&Array.from(t.values()).forEach((e=>{const t=this.refIds.get(e);this.deletedRefs.has(t)||this.removeRef(t)}));this.refs.delete(e),delete this.refCounts[e],delete this.callbacks[e]})),this.deletedRefs.clear()}addCallback(t,r,n){if(void 0===t){const t="number"==typeof r?e.OPERATION[r]:r;throw new Error(`Can't addCallback on '${t}' (refId is undefined)`)}return this.callbacks[t]||(this.callbacks[t]={}),this.callbacks[t][r]||(this.callbacks[t][r]=[]),this.callbacks[t][r].push(n),()=>this.removeCallback(t,r,n)}removeCallback(e,t,r){const n=this.callbacks?.[e]?.[t]?.indexOf(r);-1!==n&&dt(this.callbacks[e][t],n)}}class yt{constructor(e,t){this.currentRefId=0,this.setState(e),this.context=t||new be(e.constructor)}setState(e){this.state=e,this.root=new gt,this.root.addRef(0,e)}decode(e,r={offset:0},n=this.state){const s=[],i=this.root,a=e.byteLength;let c=n.constructor[o];for(this.currentRefId=0;r.offset<a;)if(e[r.offset]!=t)if(c(this,e,r,n,s)!==xe);else{console.warn("@colyseus/schema: definition mismatch");const n={offset:r.offset};for(;r.offset<a&&(e[r.offset]!==t||(n.offset=r.offset+1,!i.refs.has(fe.number(e,n))));)r.offset++}else{r.offset++,this.currentRefId=fe.number(e,r);const t=i.refs.get(this.currentRefId);if(!t)throw new Error(`"refId" not found: ${this.currentRefId}`);n[d]?.(),c=(n=t).constructor[o]}return n[d]?.(),this.triggerChanges?.(s),i.garbageCollectDeletedRefs(),s}getInstanceType(e,t,n){let s;if(e[t.offset]===r){t.offset++;const r=fe.number(e,t);s=this.context.get(r)}return s||n}createInstanceOfType(e){return new e}removeChildRefs(t,r){const n="string"!=typeof t[u],s=this.root.refIds.get(t);t.forEach(((i,o)=>{r.push({ref:t,refId:s,op:e.OPERATION.DELETE,field:o,value:void 0,previousValue:i}),n&&this.root.removeRef(this.root.refIds.get(i))}))}}class mt extends at{}lt([Ge("string")],mt.prototype,"name",void 0),lt([Ge("string")],mt.prototype,"type",void 0),lt([Ge("number")],mt.prototype,"referencedType",void 0);class bt extends at{constructor(){super(...arguments),this.fields=new Fe}}lt([Ge("number")],bt.prototype,"id",void 0),lt([Ge("number")],bt.prototype,"extendsId",void 0),lt([Ge([mt])],bt.prototype,"fields",void 0);class wt extends at{constructor(){super(...arguments),this.types=new Fe}static encode(e,t={offset:0}){const r=e.context,n=new wt,s=new ft(n),i=r.schemas.get(e.state.constructor);i>0&&(n.rootType=i);const o=new Set,a={},c=e=>{if(void 0===e.extendsId||o.has(e.extendsId)){o.add(e.id),n.types.push(e);const t=a[e.id];void 0!==t&&(delete a[e.id],t.forEach((e=>c(e))))}else void 0===a[e.extendsId]&&(a[e.extendsId]=[]),a[e.extendsId].push(e)};r.schemas.forEach(((e,t)=>{const n=new bt;n.id=Number(e);const s=Object.getPrototypeOf(t);s!==at&&(n.extendsId=r.schemas.get(s));const i=t[Symbol.metadata];if(i!==s[Symbol.metadata])for(const e in i){const t=Number(e),s=i[t].name;if(!Object.prototype.hasOwnProperty.call(i,s))continue;const o=new mt;let a;o.name=s;const c=i[t];if("string"==typeof c.type)a=c.type;else{let e;at.is(c.type)?(a="ref",e=c.type):(a=Object.keys(c.type)[0],"string"==typeof c.type[a]?a+=":"+c.type[a]:e=c.type[a]),o.referencedType=e?r.getTypeId(e):-1}o.type=a,n.fields.push(o)}c(n)}));for(const e in a)a[e].forEach((e=>n.types.push(e)));const h=s.encodeAll(t);return Buffer.from(h,0,t.offset)}static decode(e,t){const r=new wt;new yt(r).decode(e,t);const n=new be;r.types.forEach((e=>{const t=n.get(e.extendsId)??at,r=class extends t{};be.register(r),n.add(r,e.id)}),{});const s=(e,t,r)=>{t.fields.forEach(((t,s)=>{const i=r+s;if(void 0!==t.referencedType){let r=t.type,s=n.get(t.referencedType);if(!s){const e=t.type.split(":");r=e[0],s=e[1]}"ref"===r?ve.addField(e,i,t.name,s):ve.addField(e,i,t.name,{[r]:s})}else ve.addField(e,i,t.name,t.type)}))};r.types.forEach((e=>{const t=n.get(e.id),i=ve.initialize(t),o=[];let a=e;do{o.push(a),a=r.types.find((e=>e.id===a.extendsId))}while(a);let c=0;o.reverse().forEach((e=>{s(i,e,c),c+=e.fields.length}))}));const i=new(n.get(r.rootType||0));return new yt(i,n)}}function vt(t){const r=t.root,n=r.callbacks,s=new WeakMap;let i;function o(t,n){let c=n.instance?.constructor[Symbol.metadata]||t,h=n.instance&&"function"==typeof n.instance.forEach||t&&void 0===t[Symbol.metadata];if(c&&!h){const t=function(e,t,o,a){return a&&void 0!==n.instance[t]&&!s.has(i)&&o(n.instance[t],void 0),r.addCallback(r.refIds.get(e),t,o)};return new Proxy({listen:function(e,r,o=!0){if(n.instance)return t(n.instance,e,r,o);{let a=()=>{};return n.onInstanceAvailable(((n,c)=>{a=t(n,e,r,o&&c&&!s.has(i))})),()=>a()}},onChange:function(t){return r.addCallback(r.refIds.get(n.instance),e.OPERATION.REPLACE,t)},bindTo:function(t,s){return s||(s=Object.keys(c).map((e=>c[e].name))),r.addCallback(r.refIds.get(n.instance),e.OPERATION.REPLACE,(()=>{s.forEach((e=>t[e]=n.instance[e]))}))}},{get(e,t){const s=c[c[t]];if(s){const e=n.instance?.[t],i=s=>{const i=a(n.instance).listen(t,((e,t)=>{s(e,!1),i?.()}),!1);void 0!==r.refIds.get(e)&&s(e,!0)};return o(s.type,{instance:r.refIds.get(e)&&e,parentInstance:n.instance,onInstanceAvailable:i})}return e[t]},has:(e,t)=>void 0!==c[t],set(e,t,r){throw new Error("not allowed")},deleteProperty(e,t){throw new Error("not allowed")}})}{const t=function(t,n,o){return o&&t.forEach(((e,t)=>n(e,t))),r.addCallback(r.refIds.get(t),e.OPERATION.ADD,((e,t)=>{s.set(n,!0),i=n,n(e,t),s.delete(n),i=void 0}))},o=function(t,n){return r.addCallback(r.refIds.get(t),e.OPERATION.DELETE,n)},a=function(t,n){return r.addCallback(r.refIds.get(t),e.OPERATION.REPLACE,n)};return new Proxy({onAdd:function(e,r=!0){if(n.instance)return t(n.instance,e,r&&!s.has(i));if(n.onInstanceAvailable){let o=()=>{};return n.onInstanceAvailable(((n,a)=>{o=t(n,e,r&&a&&!s.has(i))})),()=>o()}},onRemove:function(e){if(n.instance)return o(n.instance,e);if(n.onInstanceAvailable){let t=()=>{};return n.onInstanceAvailable((r=>{t=o(r,e)})),()=>t()}},onChange:function(e){if(n.instance)return a(n.instance,e);if(n.onInstanceAvailable){let t=()=>{};return n.onInstanceAvailable((r=>{t=a(r,e)})),()=>t()}}},{get(e,t){if(!e[t])throw new Error(`Can't access '${t}' through callback proxy. access the instance directly.`);return e[t]},has:(e,t)=>void 0!==e[t],set(e,t,r){throw new Error("not allowed")},deleteProperty(e,t){throw new Error("not allowed")}})}}function a(e){return o(void 0,{instance:e})}return t.triggerChanges=function(t){const s=new Set;for(let i=0,o=t.length;i<o;i++){const o=t[i],a=o.refId,c=o.ref,h=n[a];if(h){if((o.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&o.previousValue instanceof at){const t=n[r.refIds.get(o.previousValue)]?.[e.OPERATION.DELETE];for(let e=t?.length-1;e>=0;e--)t[e]()}if(c instanceof at){if(!s.has(a)){const t=h?.[e.OPERATION.REPLACE];for(let e=t?.length-1;e>=0;e--)t[e]()}if(h.hasOwnProperty(o.field)){const e=h[o.field];for(let t=e?.length-1;t>=0;t--)e[t](o.value,o.previousValue)}}else{if((o.op&e.OPERATION.DELETE)===e.OPERATION.DELETE){if(void 0!==o.previousValue){const t=h[e.OPERATION.DELETE];for(let e=t?.length-1;e>=0;e--)t[e](o.previousValue,o.dynamicIndex??o.field)}if((o.op&e.OPERATION.ADD)===e.OPERATION.ADD){const t=h[e.OPERATION.ADD];for(let e=t?.length-1;e>=0;e--)t[e](o.value,o.dynamicIndex??o.field)}}else if((o.op&e.OPERATION.ADD)===e.OPERATION.ADD&&o.previousValue!==o.value){const t=h[e.OPERATION.ADD];for(let e=t?.length-1;e>=0;e--)t[e](o.value,o.dynamicIndex??o.field)}if(o.value!==o.previousValue&&(void 0!==o.value||void 0!==o.previousValue)){const t=h[e.OPERATION.REPLACE];for(let e=t?.length-1;e>=0;e--)t[e](o.value,o.dynamicIndex??o.field)}}s.add(a)}}},a}function Et(e,t){e.triggerChanges=t}lt([Ge([bt])],wt.prototype,"types",void 0),lt([Ge("number")],wt.prototype,"rootType",void 0);class Ot{constructor(e=!1){this.iterable=e,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,e&&(this.items=[])}add(t,r=He,n=!0){const s=t?.[l];if(!s)return console.warn("StateView#add(), invalid object:",t),this;if(!s.parent&&0!==s.refId)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${s.ref.constructor.name}" instance to the state before calling view.add()`);const i=t.constructor[Symbol.metadata];this.visible.add(s),this.iterable&&n&&this.items.push(t),n&&s.parent&&this.addParentOf(s,r);let o=this.changes.get(s.refId);if(void 0===o&&(o={},this.changes.set(s.refId,o)),r!==He){let t;this.tags||(this.tags=new WeakMap),this.tags.has(s)?t=this.tags.get(s):(t=new Set,this.tags.set(s,t)),t.add(r),i?.[b]?.[r]?.forEach((t=>{s.getChange(t)!==e.OPERATION.DELETE&&(o[t]=e.OPERATION.ADD)}))}else{const t=this.invisible.has(s),n=void 0!==s.filteredChanges?s.allFilteredChanges:s.allChanges;for(let a=0,c=n.operations.length;a<c;a++){const c=n.operations[a];if(void 0===c)continue;const h=s.indexedOperations[c]??e.OPERATION.ADD,l=i?.[c].tag;s.isNew||!t&&void 0!==l&&l!==r||h===e.OPERATION.DELETE||(o[c]=h)}}return s.forEachChild(((e,t)=>{i&&void 0!==i[t].tag&&i[t].tag!==r||this.add(e.ref,r,!1)})),this}addParentOf(t,r){const n=t.parent[l],s=t.parentIndex;if(!this.visible.has(n)){this.visible.add(n);const e=n.parent?.[l];e&&void 0!==e.filteredChanges&&this.addParentOf(n,r)}if(n.getChange(s)!==e.OPERATION.DELETE){let t,i=this.changes.get(n.refId);void 0===i&&(i={},this.changes.set(n.refId,i)),this.tags||(this.tags=new WeakMap),this.tags.has(n)?t=this.tags.get(n):(t=new Set,this.tags.set(n,t)),t.add(r),i[s]=e.OPERATION.ADD}}remove(t,r=He,n=!1){const s=t[l];if(!s)return console.warn("StateView#remove(), invalid object:",t),this;this.visible.delete(s),this.iterable&&!n&&dt(this.items,this.items.indexOf(t));const i=s.ref.constructor[Symbol.metadata];let o=this.changes.get(s.refId);if(void 0===o&&(o={},this.changes.set(s.refId,o)),r===He){const t=s.parent;if(!ve.isValidInstance(t)&&s.isFiltered){const r=t[l];let n=this.changes.get(r.refId);void 0===n&&(n={},this.changes.set(r.refId,n)),n[s.parentIndex]=e.OPERATION.DELETE}else i?.[m]?.forEach((t=>o[t]=e.OPERATION.DELETE))}else i?.[b][r].forEach((t=>o[t]=e.OPERATION.DELETE));if(this.tags&&this.tags.has(s)){const e=this.tags.get(s);void 0===r?this.tags.delete(s):(e.delete(r),0===e.size&&this.tags.delete(s))}return this}has(e){return this.visible.has(e[l])}hasTag(e,t=He){const r=this.tags?.get(e[l]);return r?.has(t)??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let e=0,t=this.items.length;e<t;e++)this.remove(this.items[e],He,!0);this.items.length=0}isChangeTreeVisible(e){let t=this.visible.has(e);return!t&&e.isVisibilitySharedWithParent&&this.visible.has(e.parent[l])&&(this.visible.add(e),t=!0),t}}ge("map",{constructor:We}),ge("array",{constructor:Fe}),ge("set",{constructor:ht}),ge("collection",{constructor:ct}),e.$changes=l,e.$childType=u,e.$decoder=o,e.$deleteByIndex=h,e.$encoder=i,e.$filter=a,e.$getByIndex=c,e.$track=s,e.ArraySchema=Fe,e.ChangeTree=Se,e.CollectionSchema=ct,e.Decoder=yt,e.Encoder=ft,e.MapSchema=We,e.Metadata=ve,e.Reflection=wt,e.ReflectionField=mt,e.ReflectionType=bt,e.Schema=at,e.SetSchema=ht,e.StateView=Ot,e.TypeContext=be,e.decode=fe,e.decodeKeyValueOperation=ke,e.decodeSchemaOperation=De,e.defineCustomTypes=me,e.defineTypes=Xe,e.deprecated=Ye,e.dumpChanges=et,e.encode=V,e.encodeArray=Re,e.encodeKeyValueOperation=Ce,e.encodeSchemaOperation=_e,e.entity=qe,e.getDecoderStateCallbacks=vt,e.getRawChangesCallback=Et,e.registerType=ge,e.schema=Ze,e.type=Ge,e.view=Je}(ge.exports)),ge.exports}function me(){if(ue)return pe;ue=1;var e=ae,t=ye();return pe.H3TransportTransport=class{constructor(e){this.events=e,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(e,t={}){const r=t.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(t.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(e,r),this.wt.ready.then((e=>{console.log("WebTransport ready!",e),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter();this.wt.incomingBidirectionalStreams.getReader().read().then((e=>{this.reader=e.value.readable.getReader(),this.writer=e.value.writable.getWriter(),this.sendSeatReservation(t.room.roomId,t.sessionId,t.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()})).catch((e=>{console.error("failed to read incoming stream",e),console.error("TODO: close the connection")}))})).catch((e=>{console.log("WebTransport not ready!",e),this._close()})),this.wt.closed.then((e=>{console.log("WebTransport closed w/ success",e),this.events.onclose({code:e.closeCode,reason:e.reason})})).catch((e=>{console.log("WebTransport closed w/ error",e),this.events.onerror(e),this.events.onclose({code:e.closeCode,reason:e.reason})})).finally((()=>{this._close()}))}send(e){const r=t.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),n=new Uint8Array(r+e.length);n.set(this.lengthPrefixBuffer.subarray(0,r),0),n.set(e,r),this.writer.write(n)}sendUnreliable(e){const r=t.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),n=new Uint8Array(r+e.length);n.set(this.lengthPrefixBuffer.subarray(0,r),0),n.set(e,r),this.unreliableWriter.write(n)}close(e,t){try{this.wt.close({closeCode:e,reason:t})}catch(e){console.error(e)}}readIncomingData(){return e.__awaiter(this,void 0,void 0,(function*(){let e;for(;this.isOpen;){try{e=yield this.reader.read();const r=e.value,n={offset:0};do{const e=t.decode.number(r,n);this.events.onmessage({data:r.subarray(n.offset,n.offset+e)}),n.offset+=e}while(n.offset<r.length)}catch(e){-1===e.message.indexOf("session is closed")&&console.error("H3Transport: failed to read incoming data",e);break}if(e.done)break}}))}readIncomingUnreliableData(){return e.__awaiter(this,void 0,void 0,(function*(){let e;for(;this.isOpen;){try{e=yield this.unreliableReader.read();const r=e.value,n={offset:0};do{const e=t.decode.number(r,n);this.events.onmessage({data:r.subarray(n.offset,n.offset+e)}),n.offset+=e}while(n.offset<r.length)}catch(e){-1===e.message.indexOf("session is closed")&&console.error("H3Transport: failed to read incoming data",e);break}if(e.done)break}}))}sendSeatReservation(e,r,n){const s={offset:0},i=[];t.encode.string(i,e,s),t.encode.string(i,r,s),n&&t.encode.string(i,n,s),this.writer.write(new Uint8Array(i).buffer)}_close(){this.isOpen=!1}},pe}var be,we,ve,Ee,Oe={};function Ie(){if(ve)return Oe;ve=1;var e=we?be:(we=1,be=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")});const t=globalThis.WebSocket||e;return Oe.WebSocketTransport=class{constructor(e){this.events=e}send(e){this.ws.send(e)}sendUnreliable(e){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(e,r){try{this.ws=new t(e,{headers:r,protocols:this.protocols})}catch(r){this.ws=new t(e,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,t){this.ws.close(e,t)}get isOpen(){return this.ws.readyState===t.OPEN}},Oe}function Ae(){if(Ee)return de;Ee=1;var e=me(),t=Ie();return de.Connection=class{constructor(r){if(this.events={},"h3"===r)this.transport=new e.H3TransportTransport(this.events);else this.transport=new t.WebSocketTransport(this.events)}connect(e,t){this.transport.connect.call(this.transport,e,t)}send(e){this.transport.send(e)}sendUnreliable(e){this.transport.sendUnreliable(e)}close(e,t){this.transport.close(e,t)}get isOpen(){return this.transport.isOpen}},de}var Se,Te={};function _e(){return Se||(Se=1,(e=Te).Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(e.Protocol||(e.Protocol={})),e.ErrorCode=void 0,(t=e.ErrorCode||(e.ErrorCode={}))[t.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",t[t.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",t[t.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",t[t.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",t[t.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",t[t.AUTH_FAILED=4215]="AUTH_FAILED",t[t.APPLICATION_ERROR=4216]="APPLICATION_ERROR"),Te;var e,t}var Ce,Re={};function xe(){if(Ce)return Re;Ce=1;const e={};return Re.getSerializer=function(t){const r=e[t];if(!r)throw new Error("missing serializer: "+t);return r},Re.registerSerializer=function(t,r){e[t]=r},Re}var Pe,De={};function ke(){if(Pe)return De;Pe=1;return De.createNanoEvents=()=>({emit(e,...t){let r=this.events[e]||[];for(let e=0,n=r.length;e<n;e++)r[e](...t)},events:{},on(e,t){var r;return(null===(r=this.events[e])||void 0===r?void 0:r.push(t))||(this.events[e]=[t]),()=>{var r;this.events[e]=null===(r=this.events[e])||void 0===r?void 0:r.filter((e=>t!==e))}}}),De}var $e,Ne={};function Ue(){if($e)return Ne;$e=1;class e{constructor(){this.handlers=[]}register(e,t=!1){return this.handlers.push(e),this}invoke(...e){this.handlers.forEach((t=>t.apply(this,e)))}invokeAsync(...e){return Promise.all(this.handlers.map((t=>t.apply(this,e))))}remove(e){const t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}return Ne.EventEmitter=e,Ne.createSignal=function(){const t=new e;function r(e){return t.register(e,null===this)}return r.once=e=>{const r=function(...n){e.apply(this,n),t.remove(r)};t.register(r)},r.remove=e=>t.remove(e),r.invoke=(...e)=>t.invoke(...e),r.invokeAsync=(...e)=>t.invokeAsync(...e),r.clear=()=>t.clear(),r},Ne}var Me,je,Be,Le,Fe={};function Ve(){if(Me)return Fe;Me=1;var e=ye();return Fe.SchemaSerializer=class{setState(e,t){this.decoder.decode(e,t)}getState(){return this.state}patch(e,t){return this.decoder.decode(e,t)}teardown(){this.decoder.root.clearRefs()}handshake(t,r){this.state?(e.Reflection.decode(t,r),this.decoder=new e.Decoder(this.state)):(this.decoder=e.Reflection.decode(t,r),this.state=this.decoder.state)}},Fe.getStateCallbacks=function(t){try{return e.getDecoderStateCallbacks(t.serializer.decoder)}catch(e){return}},Fe}try{je=new TextDecoder}catch(e){}var ze,We,He,qe,Je,Ge=0,Ke={},Ye=0,Xe=0,Ze=[],Qe={useRecords:!1,mapsAsObjects:!0};class et{}const tt=new et;tt.name="MessagePack 0xC1";var rt=!1,nt=2;try{new Function("")}catch(e){nt=1/0}class st{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.sequential&&!1!==e.trusted&&(e.trusted=!0,e.structures||0==e.useRecords||(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(Be)return kt((()=>($t(),this?this.unpack(e,t):st.prototype.unpack.call(Qe,e,t))));e.buffer||e.constructor!==ArrayBuffer||(e="undefined"!=typeof Buffer?Buffer.from(e):new Uint8Array(e)),"object"==typeof t?(Le=t.end||e.length,Ge=t.start||0):(Ge=0,Le=t>-1?t:e.length),Xe=0,We=null,He=null,Be=e;try{Je=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(Be=null,e instanceof Uint8Array)throw t;throw new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof st){if(Ke=this,this.structures)return ze=this.structures,it(t);(!ze||ze.length>0)&&(ze=[])}else Ke=Qe,(!ze||ze.length>0)&&(ze=[]);return it(t)}unpackMultiple(e,t){let r,n=0;try{rt=!0;let s=e.length,i=this?this.unpack(e,s):Mt.unpack(e,s);if(!t){for(r=[i];Ge<s;)n=Ge,r.push(it());return r}if(!1===t(i,n,Ge))return;for(;Ge<s;)if(n=Ge,!1===t(it(),n,Ge))return}catch(e){throw e.lastPosition=n,e.values=r,e}finally{rt=!1,$t()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map((e=>e.slice(0))));for(let t=0,r=e.length;t<r;t++){let r=e[t];r&&(r.isShared=!0,t>=32&&(r.highByte=t-32>>5))}e.sharedLength=e.length;for(let r in t||[])if(r>=0){let n=e[r],s=t[r];s&&(n&&((e.restoreStructures||(e.restoreStructures=[]))[r]=n),e[r]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function it(e){try{if(!Ke.trusted&&!rt){let e=ze.sharedLength||0;e<ze.length&&(ze.length=e)}let e;if(Ke.randomAccessStructure&&Be[Ge]<64&&Be[Ge],e=at(),He&&(Ge=He.postBundlePosition,He=null),rt&&(ze.restoreStructures=null),Ge==Le)ze&&ze.restoreStructures&&ot(),ze=null,Be=null,qe&&(qe=null);else{if(Ge>Le)throw new Error("Unexpected end of MessagePack data");if(!rt){let t;try{t=JSON.stringify(e,((e,t)=>"bigint"==typeof t?`${t}n`:t)).slice(0,100)}catch(e){t="(JSON view not available "+e+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw ze&&ze.restoreStructures&&ot(),$t(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||Ge>Le)&&(e.incomplete=!0),e}}function ot(){for(let e in ze.restoreStructures)ze[e]=ze.restoreStructures[e];ze.restoreStructures=null}function at(){let e=Be[Ge++];if(e<160){if(e<128){if(e<64)return e;{let t=ze[63&e]||Ke.getStructures&&ut()[63&e];return t?(t.read||(t.read=ht(t,63&e)),t.read()):e}}if(e<144){if(e-=128,Ke.mapsAsObjects){let t={};for(let r=0;r<e;r++){let e=Tt();"__proto__"===e&&(e="__proto_"),t[e]=at()}return t}{let t=new Map;for(let r=0;r<e;r++)t.set(at(),at());return t}}{e-=144;let t=new Array(e);for(let r=0;r<e;r++)t[r]=at();return Ke.freezeData?Object.freeze(t):t}}if(e<192){let t=e-160;if(Xe>=Ge)return We.slice(Ge-Ye,(Ge+=t)-Ye);if(0==Xe&&Le<140){let e=t<16?Et(t):vt(t);if(null!=e)return e}return ft(t)}{let t;switch(e){case 192:return null;case 193:return He?(t=at(),t>0?He[1].slice(He.position1,He.position1+=t):He[0].slice(He.position0,He.position0-=t)):tt;case 194:return!1;case 195:return!0;case 196:if(t=Be[Ge++],void 0===t)throw new Error("Unexpected end of buffer");return It(t);case 197:return t=Je.getUint16(Ge),Ge+=2,It(t);case 198:return t=Je.getUint32(Ge),Ge+=4,It(t);case 199:return At(Be[Ge++]);case 200:return t=Je.getUint16(Ge),Ge+=2,At(t);case 201:return t=Je.getUint32(Ge),Ge+=4,At(t);case 202:if(t=Je.getFloat32(Ge),Ke.useFloat32>2){let e=Nt[(127&Be[Ge])<<1|Be[Ge+1]>>7];return Ge+=4,(e*t+(t>0?.5:-.5)|0)/e}return Ge+=4,t;case 203:return t=Je.getFloat64(Ge),Ge+=8,t;case 204:return Be[Ge++];case 205:return t=Je.getUint16(Ge),Ge+=2,t;case 206:return t=Je.getUint32(Ge),Ge+=4,t;case 207:return"number"===Ke.int64AsType?(t=4294967296*Je.getUint32(Ge),t+=Je.getUint32(Ge+4)):"string"===Ke.int64AsType?t=Je.getBigUint64(Ge).toString():"auto"===Ke.int64AsType?(t=Je.getBigUint64(Ge),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Je.getBigUint64(Ge),Ge+=8,t;case 208:return Je.getInt8(Ge++);case 209:return t=Je.getInt16(Ge),Ge+=2,t;case 210:return t=Je.getInt32(Ge),Ge+=4,t;case 211:return"number"===Ke.int64AsType?(t=4294967296*Je.getInt32(Ge),t+=Je.getUint32(Ge+4)):"string"===Ke.int64AsType?t=Je.getBigInt64(Ge).toString():"auto"===Ke.int64AsType?(t=Je.getBigInt64(Ge),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Je.getBigInt64(Ge),Ge+=8,t;case 212:if(t=Be[Ge++],114==t)return Ct(63&Be[Ge++]);{let e=Ze[t];if(e)return e.read?(Ge++,e.read(at())):e.noBuffer?(Ge++,e()):e(Be.subarray(Ge,++Ge));throw new Error("Unknown extension "+t)}case 213:return t=Be[Ge],114==t?(Ge++,Ct(63&Be[Ge++],Be[Ge++])):At(2);case 214:return At(4);case 215:return At(8);case 216:return At(16);case 217:return t=Be[Ge++],Xe>=Ge?We.slice(Ge-Ye,(Ge+=t)-Ye):dt(t);case 218:return t=Je.getUint16(Ge),Xe>=(Ge+=2)?We.slice(Ge-Ye,(Ge+=t)-Ye):pt(t);case 219:return t=Je.getUint32(Ge),Xe>=(Ge+=4)?We.slice(Ge-Ye,(Ge+=t)-Ye):gt(t);case 220:return t=Je.getUint16(Ge),Ge+=2,mt(t);case 221:return t=Je.getUint32(Ge),Ge+=4,mt(t);case 222:return t=Je.getUint16(Ge),Ge+=2,bt(t);case 223:return t=Je.getUint32(Ge),Ge+=4,bt(t);default:if(e>=224)return e-256;if(void 0===e){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+e)}}}const ct=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function ht(e,t){function r(){if(r.count++>nt){let r=e.read=new Function("r","return function(){return "+(Ke.freezeData?"Object.freeze":"")+"({"+e.map((e=>"__proto__"===e?"__proto_:r()":ct.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"})}")(at);return 0===e.highByte&&(e.read=lt(t,e.read)),r()}let n={};for(let t=0,r=e.length;t<r;t++){let r=e[t];"__proto__"===r&&(r="__proto_"),n[r]=at()}return Ke.freezeData?Object.freeze(n):n}return r.count=0,0===e.highByte?lt(t,r):r}const lt=(e,t)=>function(){let r=Be[Ge++];if(0===r)return t();let n=e<32?-(e+(r<<5)):e+(r<<5),s=ze[n]||ut()[n];if(!s)throw new Error("Record id is not defined for "+n);return s.read||(s.read=ht(s,e)),s.read()};function ut(){let e=kt((()=>(Be=null,Ke.getStructures())));return ze=Ke._mergeStructures(e,ze)}var ft=yt,dt=yt,pt=yt,gt=yt;function yt(e){let t;if(e<16&&(t=Et(e)))return t;if(e>64&&je)return je.decode(Be.subarray(Ge,Ge+=e));const r=Ge+e,n=[];for(t="";Ge<r;){const e=Be[Ge++];if(128&e)if(192==(224&e)){const t=63&Be[Ge++];n.push((31&e)<<6|t)}else if(224==(240&e)){const t=63&Be[Ge++],r=63&Be[Ge++];n.push((31&e)<<12|t<<6|r)}else if(240==(248&e)){let t=(7&e)<<18|(63&Be[Ge++])<<12|(63&Be[Ge++])<<6|63&Be[Ge++];t>65535&&(t-=65536,n.push(t>>>10&1023|55296),t=56320|1023&t),n.push(t)}else n.push(e);else n.push(e);n.length>=4096&&(t+=wt.apply(String,n),n.length=0)}return n.length>0&&(t+=wt.apply(String,n)),t}function mt(e){let t=new Array(e);for(let r=0;r<e;r++)t[r]=at();return Ke.freezeData?Object.freeze(t):t}function bt(e){if(Ke.mapsAsObjects){let t={};for(let r=0;r<e;r++){let e=Tt();"__proto__"===e&&(e="__proto_"),t[e]=at()}return t}{let t=new Map;for(let r=0;r<e;r++)t.set(at(),at());return t}}var wt=String.fromCharCode;function vt(e){let t=Ge,r=new Array(e);for(let n=0;n<e;n++){const e=Be[Ge++];if((128&e)>0)return void(Ge=t);r[n]=e}return wt.apply(String,r)}function Et(e){if(e<4){if(e<2){if(0===e)return"";{let e=Be[Ge++];return(128&e)>1?void(Ge-=1):wt(e)}}{let t=Be[Ge++],r=Be[Ge++];if((128&t)>0||(128&r)>0)return void(Ge-=2);if(e<3)return wt(t,r);let n=Be[Ge++];return(128&n)>0?void(Ge-=3):wt(t,r,n)}}{let t=Be[Ge++],r=Be[Ge++],n=Be[Ge++],s=Be[Ge++];if((128&t)>0||(128&r)>0||(128&n)>0||(128&s)>0)return void(Ge-=4);if(e<6){if(4===e)return wt(t,r,n,s);{let e=Be[Ge++];return(128&e)>0?void(Ge-=5):wt(t,r,n,s,e)}}if(e<8){let i=Be[Ge++],o=Be[Ge++];if((128&i)>0||(128&o)>0)return void(Ge-=6);if(e<7)return wt(t,r,n,s,i,o);let a=Be[Ge++];return(128&a)>0?void(Ge-=7):wt(t,r,n,s,i,o,a)}{let i=Be[Ge++],o=Be[Ge++],a=Be[Ge++],c=Be[Ge++];if((128&i)>0||(128&o)>0||(128&a)>0||(128&c)>0)return void(Ge-=8);if(e<10){if(8===e)return wt(t,r,n,s,i,o,a,c);{let e=Be[Ge++];return(128&e)>0?void(Ge-=9):wt(t,r,n,s,i,o,a,c,e)}}if(e<12){let h=Be[Ge++],l=Be[Ge++];if((128&h)>0||(128&l)>0)return void(Ge-=10);if(e<11)return wt(t,r,n,s,i,o,a,c,h,l);let u=Be[Ge++];return(128&u)>0?void(Ge-=11):wt(t,r,n,s,i,o,a,c,h,l,u)}{let h=Be[Ge++],l=Be[Ge++],u=Be[Ge++],f=Be[Ge++];if((128&h)>0||(128&l)>0||(128&u)>0||(128&f)>0)return void(Ge-=12);if(e<14){if(12===e)return wt(t,r,n,s,i,o,a,c,h,l,u,f);{let e=Be[Ge++];return(128&e)>0?void(Ge-=13):wt(t,r,n,s,i,o,a,c,h,l,u,f,e)}}{let d=Be[Ge++],p=Be[Ge++];if((128&d)>0||(128&p)>0)return void(Ge-=14);if(e<15)return wt(t,r,n,s,i,o,a,c,h,l,u,f,d,p);let g=Be[Ge++];return(128&g)>0?void(Ge-=15):wt(t,r,n,s,i,o,a,c,h,l,u,f,d,p,g)}}}}}function Ot(){let e,t=Be[Ge++];if(t<192)e=t-160;else switch(t){case 217:e=Be[Ge++];break;case 218:e=Je.getUint16(Ge),Ge+=2;break;case 219:e=Je.getUint32(Ge),Ge+=4;break;default:throw new Error("Expected string")}return yt(e)}function It(e){return Ke.copyBuffers?Uint8Array.prototype.slice.call(Be,Ge,Ge+=e):Be.subarray(Ge,Ge+=e)}function At(e){let t=Be[Ge++];if(Ze[t]){let r;return Ze[t](Be.subarray(Ge,r=Ge+=e),(e=>{Ge=e;try{return at()}finally{Ge=r}}))}throw new Error("Unknown extension type "+t)}var St=new Array(4096);function Tt(){let e=Be[Ge++];if(!(e>=160&&e<192))return Ge--,_t(at());if(e-=160,Xe>=Ge)return We.slice(Ge-Ye,(Ge+=e)-Ye);if(!(0==Xe&&Le<180))return ft(e);let t,r=4095&(e<<5^(e>1?Je.getUint16(Ge):e>0?Be[Ge]:0)),n=St[r],s=Ge,i=Ge+e-3,o=0;if(n&&n.bytes==e){for(;s<i;){if(t=Je.getUint32(s),t!=n[o++]){s=1879048192;break}s+=4}for(i+=3;s<i;)if(t=Be[s++],t!=n[o++]){s=1879048192;break}if(s===i)return Ge=s,n.string;i-=3,s=Ge}for(n=[],St[r]=n,n.bytes=e;s<i;)t=Je.getUint32(s),n.push(t),s+=4;for(i+=3;s<i;)t=Be[s++],n.push(t);let a=e<16?Et(e):vt(e);return n.string=null!=a?a:ft(e)}function _t(e){if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e||"bigint"==typeof e)return e.toString();if(null==e)return e+"";if(Ke.allowArraysInMapKeys&&Array.isArray(e)&&e.flat().every((e=>["string","number","boolean","bigint"].includes(typeof e))))return e.flat().toString();throw new Error("Invalid property type for record: "+typeof e)}const Ct=(e,t)=>{let r=at().map(_t),n=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,r.highByte=t);let s=ze[e];return s&&(s.isShared||rt)&&((ze.restoreStructures||(ze.restoreStructures=[]))[e]=s),ze[e]=r,r.read=ht(r,n),r.read()};Ze[0]=()=>{},Ze[0].noBuffer=!0,Ze[66]=e=>{let t=e.length,r=BigInt(128&e[0]?e[0]-256:e[0]);for(let n=1;n<t;n++)r<<=BigInt(8),r+=BigInt(e[n]);return r};let Rt={Error:Error,TypeError:TypeError,ReferenceError:ReferenceError};Ze[101]=()=>{let e=at();return(Rt[e[0]]||Error)(e[1],{cause:e[2]})},Ze[105]=e=>{if(!1===Ke.structuredClone)throw new Error("Structured clone extension is disabled");let t=Je.getUint32(Ge-4);qe||(qe=new Map);let r,n=Be[Ge];r=n>=144&&n<160||220==n||221==n?[]:{};let s={target:r};qe.set(t,s);let i=at();return s.used?Object.assign(r,i):(s.target=i,i)},Ze[112]=e=>{if(!1===Ke.structuredClone)throw new Error("Structured clone extension is disabled");let t=Je.getUint32(Ge-4),r=qe.get(t);return r.used=!0,r.target},Ze[115]=()=>new Set(at());const xt=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((e=>e+"Array"));let Pt="object"==typeof globalThis?globalThis:window;Ze[116]=e=>{let t=e[0],r=xt[t];if(!r){if(16===t){let t=new ArrayBuffer(e.length-1);return new Uint8Array(t).set(e.subarray(1)),t}throw new Error("Could not find typed array for code "+t)}return new Pt[r](Uint8Array.prototype.slice.call(e,1).buffer)},Ze[120]=()=>{let e=at();return new RegExp(e[0],e[1])};const Dt=[];function kt(e){let t=Le,r=Ge,n=Ye,s=Xe,i=We,o=qe,a=He,c=new Uint8Array(Be.slice(0,Le)),h=ze,l=ze.slice(0,ze.length),u=Ke,f=rt,d=e();return Le=t,Ge=r,Ye=n,Xe=s,We=i,qe=o,He=a,Be=c,rt=f,(ze=h).splice(0,ze.length,...l),Ke=u,Je=new DataView(Be.buffer,Be.byteOffset,Be.byteLength),d}function $t(){Be=null,qe=null,ze=null}Ze[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],r=Ge;return Ge+=t-e.length,He=Dt,(He=[Ot(),Ot()]).position0=0,He.position1=0,He.postBundlePosition=Ge,Ge=r,at()},Ze[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");const Nt=new Array(147);for(let e=0;e<256;e++)Nt[e]=+("1e"+Math.floor(45.15-.30103*e));const Ut=st;var Mt=new st({useRecords:!1});const jt=Mt.unpack,Bt=Mt.unpackMultiple,Lt=Mt.unpack,Ft={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let Vt,zt,Wt,Ht=new Float32Array(1),qt=new Uint8Array(Ht.buffer,0,4);try{Vt=new TextEncoder}catch(e){}const Jt="undefined"!=typeof Buffer,Gt=Jt?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,Kt=Jt?Buffer:Uint8Array,Yt=Jt?4294967296:2144337920;let Xt,Zt,Qt,er,tr=0,rr=null;const nr=/[\u0080-\uFFFF]/,sr=Symbol("record-id");class ir extends st{constructor(e){let t,r,n,s;super(e),this.offset=0;let i=Kt.prototype.utf8Write?function(e,t){return Xt.utf8Write(e,t,Xt.byteLength-t)}:!(!Vt||!Vt.encodeInto)&&function(e,t){return Vt.encodeInto(e,Xt.subarray(t)).written},o=this;e||(e={});let a=e&&e.sequential,c=e.structures||e.saveStructures,h=e.maxSharedStructures;if(null==h&&(h=c?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&null==e.moreTypes&&(this.moreTypes=!0);let l=e.maxOwnStructures;null==l&&(l=c?32:64),this.structures||0==e.useRecords||(this.structures=[]);let u=h>32||l+h>64,f=h+64,d=h+l+64;if(d>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],g=0,y=0;this.pack=this.encode=function(e,i){if(Xt||(Xt=new Gt(8192),Qt=Xt.dataView||(Xt.dataView=new DataView(Xt.buffer,0,8192)),tr=0),er=Xt.length-10,er-tr<2048?(Xt=new Gt(Xt.length),Qt=Xt.dataView||(Xt.dataView=new DataView(Xt.buffer,0,Xt.length)),er=Xt.length-10,tr=0):tr=tr+7&2147483640,t=tr,i&vr&&(tr+=255&i),s=o.structuredClone?new Map:null,o.bundleStrings&&"string"!=typeof e?(rr=[],rr.size=1/0):rr=null,n=o.structures,n){n.uninitialized&&(n=o._mergeStructures(o.getStructures()));let e=n.sharedLength||0;if(e>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+n.sharedLength);if(!n.transitions){n.transitions=Object.create(null);for(let t=0;t<e;t++){let e=n[t];if(!e)continue;let r,s=n.transitions;for(let t=0,n=e.length;t<n;t++){let n=e[t];r=s[n],r||(r=s[n]=Object.create(null)),s=r}s[sr]=t+64}this.lastNamedStructuresLength=e}a||(n.nextId=e+64)}let c;r&&(r=!1);try{o.randomAccessStructure&&e&&e.constructor&&e.constructor===Object?_(e):w(e);let r=rr;if(rr&&hr(t,w,0),s&&s.idsToInsert){let e=s.idsToInsert.sort(((e,t)=>e.offset>t.offset?1:-1)),n=e.length,i=-1;for(;r&&n>0;){let s=e[--n].offset+t;s<r.stringsPosition+t&&-1===i&&(i=0),s>r.position+t?i>=0&&(i+=6):(i>=0&&(Qt.setUint32(r.position+t,Qt.getUint32(r.position+t)+i),i=-1),r=r.previous,n++)}i>=0&&r&&Qt.setUint32(r.position+t,Qt.getUint32(r.position+t)+i),tr+=6*e.length,tr>er&&A(tr),o.offset=tr;let a=function(e,t){let r,n=6*t.length,s=e.length-n;for(;r=t.pop();){let t=r.offset,i=r.id;e.copyWithin(t+n,t,s),n-=6;let o=t+n;e[o++]=214,e[o++]=105,e[o++]=i>>24,e[o++]=i>>16&255,e[o++]=i>>8&255,e[o++]=255&i,s=t}return e}(Xt.subarray(t,tr),e);return s=null,a}return o.offset=tr,i&br?(Xt.start=t,Xt.end=tr,Xt):Xt.subarray(t,tr)}catch(e){throw c=e,e}finally{if(n&&(m(),r&&o.saveStructures)){let r=n.sharedLength||0,s=Xt.subarray(t,tr),a=function(e,t){return e.isCompatible=e=>{let r=!e||(t.lastNamedStructuresLength||0)===e.length;return r||t._mergeStructures(e),r},e}(n,o);if(!c)return!1===o.saveStructures(a,a.isCompatible)?o.pack(e,i):(o.lastNamedStructuresLength=r,Xt.length>1073741824&&(Xt=null),s)}Xt.length>1073741824&&(Xt=null),i&wr&&(tr=t)}};const m=()=>{y<10&&y++;let e=n.sharedLength||0;if(n.length>e&&!a&&(n.length=e),g>1e4)n.transitions=null,y=0,g=0,p.length>0&&(p=[]);else if(p.length>0&&!a){for(let e=0,t=p.length;e<t;e++)p[e][sr]=0;p=[]}},b=e=>{var t=e.length;t<16?Xt[tr++]=144|t:t<65536?(Xt[tr++]=220,Xt[tr++]=t>>8,Xt[tr++]=255&t):(Xt[tr++]=221,Qt.setUint32(tr,t),tr+=4);for(let r=0;r<t;r++)w(e[r])},w=e=>{tr>er&&(Xt=A(tr));var r,n=typeof e;if("string"===n){let n,s=e.length;if(rr&&s>=4&&s<4096){if((rr.size+=s)>21760){let e,r,n=(rr[0]?3*rr[0].length+rr[1].length:0)+10;tr+n>er&&(Xt=A(tr+n)),rr.position?(r=rr,Xt[tr]=200,tr+=3,Xt[tr++]=98,e=tr-t,tr+=4,hr(t,w,0),Qt.setUint16(e+t-3,tr-t-e)):(Xt[tr++]=214,Xt[tr++]=98,e=tr-t,tr+=4),rr=["",""],rr.previous=r,rr.size=0,rr.position=e}let r=nr.test(e);return rr[r?0:1]+=e,Xt[tr++]=193,void w(r?-s:s)}n=s<32?1:s<256?2:s<65536?3:5;let o=3*s;if(tr+o>er&&(Xt=A(tr+o)),s<64||!i){let t,i,o,a=tr+n;for(t=0;t<s;t++)i=e.charCodeAt(t),i<128?Xt[a++]=i:i<2048?(Xt[a++]=i>>6|192,Xt[a++]=63&i|128):55296==(64512&i)&&56320==(64512&(o=e.charCodeAt(t+1)))?(i=65536+((1023&i)<<10)+(1023&o),t++,Xt[a++]=i>>18|240,Xt[a++]=i>>12&63|128,Xt[a++]=i>>6&63|128,Xt[a++]=63&i|128):(Xt[a++]=i>>12|224,Xt[a++]=i>>6&63|128,Xt[a++]=63&i|128);r=a-tr-n}else r=i(e,tr+n);r<32?Xt[tr++]=160|r:r<256?(n<2&&Xt.copyWithin(tr+2,tr+1,tr+1+r),Xt[tr++]=217,Xt[tr++]=r):r<65536?(n<3&&Xt.copyWithin(tr+3,tr+2,tr+2+r),Xt[tr++]=218,Xt[tr++]=r>>8,Xt[tr++]=255&r):(n<5&&Xt.copyWithin(tr+5,tr+3,tr+3+r),Xt[tr++]=219,Qt.setUint32(tr,r),tr+=4),tr+=r}else if("number"===n)if(e>>>0===e)e<32||e<128&&!1===this.useRecords||e<64&&!this.randomAccessStructure?Xt[tr++]=e:e<256?(Xt[tr++]=204,Xt[tr++]=e):e<65536?(Xt[tr++]=205,Xt[tr++]=e>>8,Xt[tr++]=255&e):(Xt[tr++]=206,Qt.setUint32(tr,e),tr+=4);else if((e|0)===e)e>=-32?Xt[tr++]=256+e:e>=-128?(Xt[tr++]=208,Xt[tr++]=e+256):e>=-32768?(Xt[tr++]=209,Qt.setInt16(tr,e),tr+=2):(Xt[tr++]=210,Qt.setInt32(tr,e),tr+=4);else{let t;if((t=this.useFloat32)>0&&e<4294967296&&e>=-2147483648){let r;if(Xt[tr++]=202,Qt.setFloat32(tr,e),t<4||((r=e*Nt[(127&Xt[tr])<<1|Xt[tr+1]>>7])|0)===r)return void(tr+=4);tr--}Xt[tr++]=203,Qt.setFloat64(tr,e),tr+=8}else if("object"===n||"function"===n)if(e){if(s){let r=s.get(e);if(r){if(!r.id){let e=s.idsToInsert||(s.idsToInsert=[]);r.id=e.push(r)}return Xt[tr++]=214,Xt[tr++]=112,Qt.setUint32(tr,r.id),void(tr+=4)}s.set(e,{offset:tr-t})}let i=e.constructor;if(i===Object)I(e);else if(i===Array)b(e);else if(i===Map)if(this.mapAsEmptyObject)Xt[tr++]=128;else{(r=e.size)<16?Xt[tr++]=128|r:r<65536?(Xt[tr++]=222,Xt[tr++]=r>>8,Xt[tr++]=255&r):(Xt[tr++]=223,Qt.setUint32(tr,r),tr+=4);for(let[t,r]of e)w(t),w(r)}else{for(let t=0,r=zt.length;t<r;t++){if(e instanceof Wt[t]){let r=zt[t];if(r.write){r.type&&(Xt[tr++]=212,Xt[tr++]=r.type,Xt[tr++]=0);let t=r.write.call(this,e);return void(t===e?Array.isArray(e)?b(e):I(e):w(t))}let n,s=Xt,i=Qt,o=tr;Xt=null;try{n=r.pack.call(this,e,(e=>(Xt=s,s=null,tr+=e,tr>er&&A(tr),{target:Xt,targetView:Qt,position:tr-e})),w)}finally{s&&(Xt=s,Qt=i,tr=o,er=Xt.length-10)}return void(n&&(n.length+tr>er&&A(n.length+tr),tr=cr(n,Xt,tr,r.type)))}}if(Array.isArray(e))b(e);else{if(e.toJSON){const t=e.toJSON();if(t!==e)return w(t)}if("function"===n)return w(this.writeFunction&&this.writeFunction(e));I(e)}}}else Xt[tr++]=192;else if("boolean"===n)Xt[tr++]=e?195:194;else if("bigint"===n){if(e<BigInt(1)<<BigInt(63)&&e>=-(BigInt(1)<<BigInt(63)))Xt[tr++]=211,Qt.setBigInt64(tr,e);else if(e<BigInt(1)<<BigInt(64)&&e>0)Xt[tr++]=207,Qt.setBigUint64(tr,e);else{if(!this.largeBigIntToFloat){if(this.largeBigIntToString)return w(e.toString());if(this.useBigIntExtension&&e<BigInt(2)**BigInt(1023)&&e>-(BigInt(2)**BigInt(1023))){Xt[tr++]=199,tr++,Xt[tr++]=66;let t,r=[];do{let n=e&BigInt(255);t=(n&BigInt(128))===(e<BigInt(0)?BigInt(128):BigInt(0)),r.push(n),e>>=BigInt(8)}while(e!==BigInt(0)&&e!==BigInt(-1)||!t);Xt[tr-2]=r.length;for(let e=r.length;e>0;)Xt[tr++]=Number(r[--e]);return}throw new RangeError(e+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Xt[tr++]=203,Qt.setFloat64(tr,Number(e))}tr+=8}else{if("undefined"!==n)throw new Error("Unknown type: "+n);this.encodeUndefinedAsNil?Xt[tr++]=192:(Xt[tr++]=212,Xt[tr++]=0,Xt[tr++]=0)}},v=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?e=>{let t;if(this.skipValues){t=[];for(let r in e)"function"==typeof e.hasOwnProperty&&!e.hasOwnProperty(r)||this.skipValues.includes(e[r])||t.push(r)}else t=Object.keys(e);let r,n=t.length;if(n<16?Xt[tr++]=128|n:n<65536?(Xt[tr++]=222,Xt[tr++]=n>>8,Xt[tr++]=255&n):(Xt[tr++]=223,Qt.setUint32(tr,n),tr+=4),this.coercibleKeyAsNumber)for(let s=0;s<n;s++){r=t[s];let n=Number(r);w(isNaN(n)?r:n),w(e[r])}else for(let s=0;s<n;s++)w(r=t[s]),w(e[r])}:e=>{Xt[tr++]=222;let r=tr-t;tr+=2;let n=0;for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(w(t),w(e[t]),n++);if(n>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');Xt[r+++t]=n>>8,Xt[r+t]=255&n},E=!1===this.useRecords?v:e.progressiveRecords&&!u?e=>{let r,s,i=n.transitions||(n.transitions=Object.create(null)),o=tr++-t;for(let a in e)if("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(a)){if(r=i[a],r)i=r;else{let c=Object.keys(e),h=i;i=n.transitions;let l=0;for(let e=0,t=c.length;e<t;e++){let t=c[e];r=i[t],r||(r=i[t]=Object.create(null),l++),i=r}o+t+1==tr?(tr--,S(i,c,l)):T(i,c,o,l),s=!0,i=h[a]}w(e[a])}if(!s){let r=i[sr];r?Xt[o+t]=r:T(i,Object.keys(e),o,0)}}:e=>{let t,r=n.transitions||(n.transitions=Object.create(null)),s=0;for(let n in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(n))&&(t=r[n],t||(t=r[n]=Object.create(null),s++),r=t);let i=r[sr];i?i>=96&&u?(Xt[tr++]=96+(31&(i-=96)),Xt[tr++]=i>>5):Xt[tr++]=i:S(r,r.__keys__||Object.keys(e),s);for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&w(e[t])},O="function"==typeof this.useRecords&&this.useRecords,I=O?e=>{O(e)?E(e):v(e)}:E,A=e=>{let r;if(e>16777216){if(e-t>Yt)throw new Error("Packed buffer would be larger than maximum buffer size");r=Math.min(Yt,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else r=1+(Math.max(e-t<<2,Xt.length-1)>>12)<<12;let n=new Gt(r);return Qt=n.dataView||(n.dataView=new DataView(n.buffer,0,r)),e=Math.min(e,Xt.length),Xt.copy?Xt.copy(n,0,t,e):n.set(Xt.slice(t,e)),tr-=t,t=0,er=n.length-10,Xt=n},S=(e,t,s)=>{let i=n.nextId;i||(i=64),i<f&&this.shouldShareStructure&&!this.shouldShareStructure(t)?(i=n.nextOwnId,i<d||(i=f),n.nextOwnId=i+1):(i>=d&&(i=f),n.nextId=i+1);let o=t.highByte=i>=96&&u?i-96>>5:-1;e[sr]=i,e.__keys__=t,n[i-64]=t,i<f?(t.isShared=!0,n.sharedLength=i-63,r=!0,o>=0?(Xt[tr++]=96+(31&i),Xt[tr++]=o):Xt[tr++]=i):(o>=0?(Xt[tr++]=213,Xt[tr++]=114,Xt[tr++]=96+(31&i),Xt[tr++]=o):(Xt[tr++]=212,Xt[tr++]=114,Xt[tr++]=i),s&&(g+=y*s),p.length>=l&&(p.shift()[sr]=0),p.push(e),w(t))},T=(e,r,n,s)=>{let i=Xt,o=tr,a=er,c=t;Xt=Zt,tr=0,t=0,Xt||(Zt=Xt=new Gt(8192)),er=Xt.length-10,S(e,r,s),Zt=Xt;let h=tr;if(Xt=i,tr=o,er=a,t=c,h>1){let e=tr+h-1;e>er&&A(e);let r=n+t;Xt.copyWithin(r+h,r+1,tr),Xt.set(Zt.slice(0,h),r),tr=e}else Xt[n+t]=Zt[0]},_=e=>{let s=undefined(e,Xt,t,tr,n,A,((e,t,n)=>{if(n)return r=!0;tr=t;let s=Xt;return w(e),m(),s!==Xt?{position:tr,targetView:Qt,target:Xt}:tr}),this);if(0===s)return I(e);tr=s}}useBuffer(e){Xt=e,Xt.dataView||(Xt.dataView=new DataView(Xt.buffer,Xt.byteOffset,Xt.byteLength)),tr=0}set position(e){tr=e}get position(){return tr}set buffer(e){Xt=e}get buffer(){return Xt}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}function or(e,t,r,n){let s=e.byteLength;if(s+1<256){var{target:i,position:o}=r(4+s);i[o++]=199,i[o++]=s+1}else if(s+1<65536){var{target:i,position:o}=r(5+s);i[o++]=200,i[o++]=s+1>>8,i[o++]=s+1&255}else{var{target:i,position:o,targetView:a}=r(7+s);i[o++]=201,a.setUint32(o,s+1),o+=4}i[o++]=116,i[o++]=t,e.buffer||(e=new Uint8Array(e)),i.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function ar(e,t){let r=e.byteLength;var n,s;if(r<256){var{target:n,position:s}=t(r+2);n[s++]=196,n[s++]=r}else if(r<65536){var{target:n,position:s}=t(r+3);n[s++]=197,n[s++]=r>>8,n[s++]=255&r}else{var{target:n,position:s,targetView:i}=t(r+5);n[s++]=198,i.setUint32(s,r),s+=4}n.set(e,s)}function cr(e,t,r,n){let s=e.length;switch(s){case 1:t[r++]=212;break;case 2:t[r++]=213;break;case 4:t[r++]=214;break;case 8:t[r++]=215;break;case 16:t[r++]=216;break;default:s<256?(t[r++]=199,t[r++]=s):s<65536?(t[r++]=200,t[r++]=s>>8,t[r++]=255&s):(t[r++]=201,t[r++]=s>>24,t[r++]=s>>16&255,t[r++]=s>>8&255,t[r++]=255&s)}return t[r++]=n,t.set(e,r),r+=s}function hr(e,t,r){if(rr.length>0){Qt.setUint32(rr.position+e,tr+r-rr.position-e),rr.stringsPosition=tr-e;let n=rr;rr=null,t(n[0]),t(n[1])}}Wt=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,et],zt=[{pack(e,t,r){let n=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&n>=0&&n<4294967296){let{target:e,targetView:r,position:s}=t(6);e[s++]=214,e[s++]=255,r.setUint32(s,n)}else if(n>0&&n<4294967296){let{target:r,targetView:s,position:i}=t(10);r[i++]=215,r[i++]=255,s.setUint32(i,4e6*e.getMilliseconds()+(n/1e3/4294967296|0)),s.setUint32(i+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),r(this.onInvalidDate());let{target:e,targetView:n,position:s}=t(3);e[s++]=212,e[s++]=255,e[s++]=255}else{let{target:r,targetView:s,position:i}=t(15);r[i++]=199,r[i++]=12,r[i++]=255,s.setUint32(i,1e6*e.getMilliseconds()),s.setBigInt64(i+4,BigInt(Math.floor(n)))}}},{pack(e,t,r){if(this.setAsEmptyObject)return t(0),r({});let n=Array.from(e),{target:s,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(s[i++]=212,s[i++]=115,s[i++]=0),r(n)}},{pack(e,t,r){let{target:n,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(n[s++]=212,n[s++]=101,n[s++]=0),r([e.name,e.message,e.cause])}},{pack(e,t,r){let{target:n,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(n[s++]=212,n[s++]=120,n[s++]=0),r([e.source,e.flags])}},{pack(e,t){this.moreTypes?or(e,16,t):ar(Jt?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let r=e.constructor;r!==Kt&&this.moreTypes?or(e,xt.indexOf(r.name),t):ar(e,t)}},{pack(e,t){let{target:r,position:n}=t(1);r[n]=193}}];let lr=new ir({useRecords:!1});const ur=lr.pack,fr=lr.pack,dr=ir,{NEVER:pr,ALWAYS:gr,DECIMAL_ROUND:yr,DECIMAL_FIT:mr}=Ft,br=512,wr=1024,vr=2048;const Er=function(e,t={}){if(!e||"object"!=typeof e)throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const r=new st(t);let n;const s=e=>{let t;n&&(e=Buffer.concat([n,e]),n=void 0);try{t=r.unpackMultiple(e)}catch(r){if(!r.incomplete)throw r;n=e.slice(r.lastPosition),t=r.values}return t};return"function"==typeof e[Symbol.iterator]?function*(){for(const t of e)yield*s(t)}():"function"==typeof e[Symbol.asyncIterator]?async function*(){for await(const t of e)yield*s(t)}():void 0},Or=function(e,t={}){if(e&&"object"==typeof e){if("function"==typeof e[Symbol.iterator])return function*(e,t){const r=new ir(t);for(const t of e)yield r.pack(t)}(e,t);if("function"==typeof e.then||"function"==typeof e[Symbol.asyncIterator])return async function*(e,t){const r=new ir(t);for await(const t of e)yield r.pack(t)}(e,t);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable")};var Ir,Ar=w(Object.freeze({__proto__:null,ALWAYS:gr,C1:tt,DECIMAL_FIT:mr,DECIMAL_ROUND:yr,Decoder:Ut,Encoder:dr,FLOAT32_OPTIONS:Ft,NEVER:pr,Packr:ir,RESERVE_START_SPACE:vr,RESET_BUFFER_MODE:wr,REUSE_BUFFER_MODE:br,Unpackr:st,addExtension:function(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");Wt.unshift(e.Class),zt.unshift(e)}!function(e){e.unpack?Ze[e.type]=e.unpack:Ze[e.type]=e}(e)},clearSource:$t,decode:Lt,decodeIter:Er,encode:fr,encodeIter:Or,isNativeAccelerationEnabled:!1,mapsAsObjects:!0,pack:ur,roundFloat32:function(e){Ht[0]=e;let t=Nt[(127&qt[3])<<1|qt[2]>>7];return(t*e+(e>0?.5:-.5)|0)/t},unpack:jt,unpackMultiple:Bt,useRecords:!1}));function Sr(){if(Ir)return fe;Ir=1;var e=Ae(),t=_e(),r=xe(),n=ke(),s=Ue(),i=ye(),o=Ve(),a=he(),c=Ar;return fe.Room=class h{constructor(e,t){this.onStateChange=s.createSignal(),this.onError=s.createSignal(),this.onLeave=s.createSignal(),this.onJoin=s.createSignal(),this.hasJoined=!1,this.onMessageHandlers=n.createNanoEvents(),this.roomId=null,this.name=e,this.packr=new c.Packr,this.packr.encode(void 0),t&&(this.serializer=new(r.getSerializer("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError(((e,t)=>{var r;return null===(r=console.warn)||void 0===r?void 0:r.call(console,`colyseus.js - onError => (${e}) ${t}`)})),this.onLeave((()=>this.removeAllListeners()))}connect(t,r,n=this,s,i){const o=new e.Connection(s.protocol);if(n.connection=o,o.events.onmessage=h.prototype.onMessageCallback.bind(n),o.events.onclose=function(e){var t;if(!n.hasJoined)return null===(t=console.warn)||void 0===t||t.call(console,`Room connection was closed unexpectedly (${e.code}): ${e.reason}`),void n.onError.invoke(e.code,e.reason);e.code===a.CloseCode.DEVMODE_RESTART&&r?r():(n.onLeave.invoke(e.code,e.reason),n.destroy())},o.events.onerror=function(e){var t;null===(t=console.warn)||void 0===t||t.call(console,`Room, onError (${e.code}): ${e.reason}`),n.onError.invoke(e.code,e.reason)},"h3"===s.protocol){const e=new URL(t);o.connect(e.origin,s)}else o.connect(t,i)}leave(e=!0){return new Promise((r=>{this.onLeave((e=>r(e))),this.connection?e?(this.packr.buffer[0]=t.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(a.CloseCode.CONSENTED)}))}onMessage(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)}send(e,r){const n={offset:1};this.packr.buffer[0]=t.Protocol.ROOM_DATA,"string"==typeof e?i.encode.string(this.packr.buffer,e,n):i.encode.number(this.packr.buffer,e,n),this.packr.position=0;const s=void 0!==r?this.packr.pack(r,2048+n.offset):this.packr.buffer.subarray(0,n.offset);this.connection.send(s)}sendUnreliable(e,r){const n={offset:1};this.packr.buffer[0]=t.Protocol.ROOM_DATA,"string"==typeof e?i.encode.string(this.packr.buffer,e,n):i.encode.number(this.packr.buffer,e,n),this.packr.position=0;const s=void 0!==r?this.packr.pack(r,2048+n.offset):this.packr.buffer.subarray(0,n.offset);this.connection.sendUnreliable(s)}sendBytes(e,r){const n={offset:1};if(this.packr.buffer[0]=t.Protocol.ROOM_DATA_BYTES,"string"==typeof e?i.encode.string(this.packr.buffer,e,n):i.encode.number(this.packr.buffer,e,n),r.byteLength+n.offset>this.packr.buffer.byteLength){const e=new Uint8Array(n.offset+r.byteLength);e.set(this.packr.buffer),this.packr.useBuffer(e)}this.packr.buffer.set(r,n.offset),this.connection.send(this.packr.buffer.subarray(0,n.offset+r.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof o.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(e){const n=new Uint8Array(e.data),s={offset:1},o=n[0];if(o===t.Protocol.JOIN_ROOM){const e=i.decode.utf8Read(n,s,n[s.offset++]);if(this.serializerId=i.decode.utf8Read(n,s,n[s.offset++]),!this.serializer){const e=r.getSerializer(this.serializerId);this.serializer=new e}n.byteLength>s.offset&&this.serializer.handshake&&this.serializer.handshake(n,s),this.reconnectionToken=`${this.roomId}:${e}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=t.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(o===t.Protocol.ERROR){const e=i.decode.number(n,s),t=i.decode.string(n,s);this.onError.invoke(e,t)}else if(o===t.Protocol.LEAVE_ROOM)this.leave();else if(o===t.Protocol.ROOM_STATE)this.serializer.setState(n,s),this.onStateChange.invoke(this.serializer.getState());else if(o===t.Protocol.ROOM_STATE_PATCH)this.serializer.patch(n,s),this.onStateChange.invoke(this.serializer.getState());else if(o===t.Protocol.ROOM_DATA){const e=i.decode.stringCheck(n,s)?i.decode.string(n,s):i.decode.number(n,s),t=n.byteLength>s.offset?c.unpack(n,{start:s.offset}):void 0;this.dispatchMessage(e,t)}else if(o===t.Protocol.ROOM_DATA_BYTES){const e=i.decode.stringCheck(n,s)?i.decode.string(n,s):i.decode.number(n,s);this.dispatchMessage(e,n.subarray(s.offset))}}dispatchMessage(e,t){var r;const n=this.getMessageHandlerKey(e);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):null===(r=console.warn)||void 0===r||r.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"string":return e;case"number":return`i${e}`;default:throw new Error("invalid message type.")}}},fe}var Tr={};function _r(e,t){t.headers=e.headers||{},t.statusMessage=e.statusText,t.statusCode=e.status,t.data=e.response}function Cr(e,t,r){return new Promise((function(n,s){r=r||{};var i,o,a,c=new XMLHttpRequest,h=r.body,l=r.headers||{};for(i in r.timeout&&(c.timeout=r.timeout),c.ontimeout=c.onerror=function(e){e.timeout="timeout"==e.type,s(e)},c.open(e,t.href||t),c.onload=function(){for(a=c.getAllResponseHeaders().trim().split(/[\r\n]+/),_r(c,c);o=a.shift();)o=o.split(": "),c.headers[o.shift().toLowerCase()]=o.join(": ");if((o=c.headers["content-type"])&&~o.indexOf("application/json"))try{c.data=JSON.parse(c.data,r.reviver)}catch(e){return _r(c,e),s(e)}(c.status>=400?s:n)(c)},typeof FormData<"u"&&h instanceof FormData||h&&"object"==typeof h&&(l["content-type"]="application/json",h=JSON.stringify(h)),c.withCredentials=!!r.withCredentials,l)c.setRequestHeader(i,l[i]);c.send(h)}))}var Rr,xr=Cr.bind(Cr,"GET"),Pr=Cr.bind(Cr,"POST"),Dr=Cr.bind(Cr,"PATCH"),kr=Cr.bind(Cr,"DELETE"),$r=Cr.bind(Cr,"PUT"),Nr=w(Object.freeze({__proto__:null,del:kr,get:xr,patch:Dr,post:Pr,put:$r,send:Cr}));function Ur(){if(Rr)return Tr;Rr=1;var e=he();function t(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var r=t(Nr);return Tr.HTTP=class{constructor(e,t={}){this.client=e,this.headers=t}get(e,t={}){return this.request("get",e,t)}post(e,t={}){return this.request("post",e,t)}del(e,t={}){return this.request("del",e,t)}put(e,t={}){return this.request("put",e,t)}request(t,n,s={}){return r[t](this.client.getHttpEndpoint(n),this.getOptions(s)).catch((t=>{var r;const n=t.statusCode,s=(null===(r=t.data)||void 0===r?void 0:r.error)||t.statusMessage||t.message;if(!n&&!s)throw t;throw new e.ServerError(n,s)}))}getOptions(e){return e.headers=Object.assign({},this.headers,e.headers),this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!=typeof cc&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}},Tr}var Mr,jr,Br={},Lr={};function Fr(){if(Mr)return Lr;Mr=1;var e=ae;let t;function r(){if(!t)try{t="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(e){}return t||void 0===globalThis.indexedDB||(t=new n),t||(t={cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),t}class n{constructor(){this.dbPromise=new Promise((e=>{const t=indexedDB.open("_colyseus_storage",1);t.onupgradeneeded=()=>t.result.createObjectStore("store"),t.onsuccess=()=>e(t.result)}))}tx(t,r){return e.__awaiter(this,void 0,void 0,(function*(){const e=(yield this.dbPromise).transaction("store",t).objectStore("store");return r(e)}))}setItem(e,t){return this.tx("readwrite",(r=>r.put(t,e))).then()}getItem(t){return e.__awaiter(this,void 0,void 0,(function*(){const e=yield this.tx("readonly",(e=>e.get(t)));return new Promise((t=>{e.onsuccess=()=>t(e.result)}))}))}removeItem(e){return this.tx("readwrite",(t=>t.delete(e))).then()}}return Lr.getItem=function(e,t){const n=r().getItem(e);"undefined"!=typeof Promise&&n instanceof Promise?n.then((e=>t(e))):t(n)},Lr.removeItem=function(e){r().removeItem(e)},Lr.setItem=function(e,t){r().setItem(e,t)},Lr}function Vr(){if(jr)return Br;jr=1;var e,t,r,n,s=ae,i=Fr(),o=ke();return e=new WeakMap,t=new WeakMap,r=new WeakMap,n=new WeakMap,Br.Auth=class{constructor(s){this.http=s,this.settings={path:"/auth",key:"colyseus-auth-token"},e.set(this,!1),t.set(this,void 0),r.set(this,void 0),n.set(this,o.createNanoEvents()),i.getItem(this.settings.key,(e=>this.token=e))}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(r){const i=s.__classPrivateFieldGet(this,n,"f").on("change",r);return s.__classPrivateFieldGet(this,e,"f")||s.__classPrivateFieldSet(this,t,new Promise(((e,t)=>{this.getUserData().then((e=>{this.emitChange(Object.assign(Object.assign({},e),{token:this.token}))})).catch((e=>{this.emitChange({user:null,token:void 0})})).finally((()=>{e()}))})),"f"),s.__classPrivateFieldSet(this,e,!0,"f"),i}getUserData(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){const n=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:t,options:r}})).data;return this.emitChange(n),n}))}signInWithEmailAndPassword(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const r=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:t}})).data;return this.emitChange(r),r}))}signInAnonymously(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(t),t}))}sendPasswordResetEmail(e){return s.__awaiter(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data}))}signInWithProvider(e){return s.__awaiter(this,arguments,void 0,(function*(e,t={}){return new Promise(((n,i)=>{const o=t.width||480,a=t.height||768,c=this.token?`?token=${this.token}`:"",h=`Login with ${e[0].toUpperCase()+e.substring(1)}`,l=this.http.client.getHttpEndpoint(`${t.prefix||`${this.settings.path}/provider`}/${e}${c}`),u=screen.width/2-o/2,f=screen.height/2-a/2;s.__classPrivateFieldSet(this,r,window.open(l,h,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+o+", height="+a+", top="+f+", left="+u),"f");const d=e=>{void 0===e.data.user&&void 0===e.data.token||(clearInterval(p),s.__classPrivateFieldGet(this,r,"f").close(),s.__classPrivateFieldSet(this,r,void 0,"f"),window.removeEventListener("message",d),void 0!==e.data.error?i(e.data.error):(n(e.data),this.emitChange(e.data)))},p=setInterval((()=>{s.__classPrivateFieldGet(this,r,"f")&&!s.__classPrivateFieldGet(this,r,"f").closed||(s.__classPrivateFieldSet(this,r,void 0,"f"),i("cancelled"),window.removeEventListener("message",d))}),200);window.addEventListener("message",d)}))}))}signOut(){return s.__awaiter(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(e){void 0!==e.token&&(this.token=e.token,null===e.token?i.removeItem(this.settings.key):i.setItem(this.settings.key,e.token)),s.__classPrivateFieldGet(this,n,"f").emit("change",e)}},Br}var zr,Wr,Hr={};function qr(){if(zr)return Hr;return zr=1,Hr.discordURLBuilder=function(e){var t;const r=(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.hostname)||"localhost",n=e.hostname.split("."),s=!e.hostname.includes("trycloudflare.com")&&!e.hostname.includes("discordsays.com")&&n.length>2?`/${n[0]}`:"";return e.pathname.startsWith("/.proxy")?`${e.protocol}//${r}${s}${e.pathname}${e.search}`:`${e.protocol}//${r}/.proxy/colyseus${s}${e.pathname}${e.search}`},Hr}function Jr(){if(Wr)return O;Wr=1;var e,t=ae,r=he(),n=Sr(),s=Ur(),i=Vr(),o=qr();class a extends Error{constructor(e,t){super(e),this.code=t,this.name="MatchMakeError",Object.setPrototypeOf(this,a.prototype)}}const c="undefined"!=typeof window&&void 0!==(null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";let h=class{constructor(e=c,t){var r,n;if("string"==typeof e){const t=e.startsWith("/")?new URL(e,c):new URL(e),r="https:"===t.protocol||"wss:"===t.protocol,n=Number(t.port||(r?443:80));this.settings={hostname:t.hostname,pathname:t.pathname,port:n,secure:r}}else void 0===e.port&&(e.port=e.secure?443:80),void 0===e.pathname&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new s.HTTP(this,(null==t?void 0:t.headers)||{}),this.auth=new i.Auth(this.http),this.urlBuilder=null==t?void 0:t.urlBuilder,!this.urlBuilder&&"undefined"!=typeof window&&(null===(n=null===(r=null===window||void 0===window?void 0:window.location)||void 0===r?void 0:r.hostname)||void 0===n?void 0:n.includes("discordsays.com"))&&(this.urlBuilder=o.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(e){return t.__awaiter(this,arguments,void 0,(function*(e,t={},r){return yield this.createMatchMakeRequest("joinOrCreate",e,t,r)}))}create(e){return t.__awaiter(this,arguments,void 0,(function*(e,t={},r){return yield this.createMatchMakeRequest("create",e,t,r)}))}join(e){return t.__awaiter(this,arguments,void 0,(function*(e,t={},r){return yield this.createMatchMakeRequest("join",e,t,r)}))}joinById(e){return t.__awaiter(this,arguments,void 0,(function*(e,t={},r){return yield this.createMatchMakeRequest("joinById",e,t,r)}))}reconnect(e,r){return t.__awaiter(this,void 0,void 0,(function*(){if("string"==typeof e&&"string"==typeof r)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[t,n]=e.split(":");if(!t||!n)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",t,{reconnectionToken:n},r)}))}consumeSeatReservation(e,n,s){return t.__awaiter(this,void 0,void 0,(function*(){const i=this.createRoom(e.room.name,n);i.roomId=e.room.roomId,i.sessionId=e.sessionId;const o={sessionId:i.sessionId};e.reconnectionToken&&(o.reconnectionToken=e.reconnectionToken);const a=s||i;return i.connect(this.buildEndpoint(e.room,o,e.protocol),e.devMode&&(()=>t.__awaiter(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${i.roomId}'...`);let r=0;const s=()=>t.__awaiter(this,void 0,void 0,(function*(){r++;try{yield this.consumeSeatReservation(e,n,a),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${i.roomId}'`)}catch(e){r<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${r} out of 8)`),setTimeout(s,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(s,2e3)}))),a,e,this.http.headers),new Promise(((e,t)=>{const n=(e,n)=>t(new r.ServerError(e,n));a.onError.once(n),a.onJoin.once((()=>{a.onError.remove(n),e(a)}))}))}))}createMatchMakeRequest(e,r){return t.__awaiter(this,arguments,void 0,(function*(e,t,r={},n,s){const i=(yield this.http.post(`matchmake/${e}/${t}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)})).data;if(i.error)throw new a(i.error,i.code);return"reconnect"===e&&(i.reconnectionToken=r.reconnectionToken),yield this.consumeSeatReservation(i,n,s)}))}createRoom(e,t){return new n.Room(e,t)}buildEndpoint(e,t={},r="ws"){const n=[];this.http.authToken&&(t._authToken=this.http.authToken);for(const e in t)t.hasOwnProperty(e)&&n.push(`${e}=${t[e]}`);"h3"===r&&(r="http");let s=this.settings.secure?`${r}s://`:`${r}://`;e.publicAddress?s+=`${e.publicAddress}`:s+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const i=`${s}/${e.processId}/${e.roomId}?${n.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(i)):i}getHttpEndpoint(e=""){const t=e.startsWith("/")?e:`/${e}`,r=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${t}`;return this.urlBuilder?this.urlBuilder(new URL(r)):r}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}};return h.VERSION="0.16.16",O.Client=h,O.MatchMakeError=a,O}var Gr,Kr,Yr={};function Xr(){if(Gr)return Yr;Gr=1;return Yr.NoneSerializer=class{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}},Yr}var Zr=(Kr||(Kr=1,function(e){v||(v=1,ArrayBuffer.isView||(ArrayBuffer.isView=e=>null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer),"undefined"==typeof FormData&&(b.FormData=class{}),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window));var t=Jr(),r=_e(),n=Sr(),s=Vr(),i=he(),o=Ve(),a=Xr(),c=xe();c.registerSerializer("schema",o.SchemaSerializer),c.registerSerializer("none",a.NoneSerializer),e.Client=t.Client,e.MatchMakeError=t.MatchMakeError,Object.defineProperty(e,"ErrorCode",{enumerable:!0,get:function(){return r.ErrorCode}}),Object.defineProperty(e,"Protocol",{enumerable:!0,get:function(){return r.Protocol}}),e.Room=n.Room,e.Auth=s.Auth,e.ServerError=i.ServerError,e.SchemaSerializer=o.SchemaSerializer,e.getStateCallbacks=o.getStateCallbacks,e.registerSerializer=c.registerSerializer}(E)),E);const Qr=()=>{};let en=!1;function tn(e,t,r){if(null==e)return t(void 0),Qr;const n=function(e){var t=en;try{return en=!0,e()}finally{en=t}}((()=>e.subscribe(t,r)));return n.unsubscribe?()=>n.unsubscribe():n}const rn=[];function nn(e,t=Qr){let r=null;const n=new Set;function s(t){if(i=t,((s=e)!=s?i==i:s!==i||null!==s&&"object"==typeof s||"function"==typeof s)&&(e=t,r)){const t=!rn.length;for(const t of n)t[1](),rn.push(t,e);if(t){for(let e=0;e<rn.length;e+=2)rn[e][0](rn[e+1]);rn.length=0}}var s,i}function i(t){s(t(e))}return{set:s,update:i,subscribe:function(o,a=Qr){const c=[o,a];return n.add(c),1===n.size&&(r=t(s,i)||Qr),o(e),()=>{n.delete(c),0===n.size&&r&&(r(),r=null)}}}}function sn(e){let t;return tn(e,(e=>t=e))(),t}class on extends EventTarget{state;setState(e){this.state.decode(e),this.dispatchEvent(new CustomEvent("patch",{detail:null})),this.dispatchEvent(new Event("load"))}getState(){return this.state}patch(e){let t=this.state.decode(e);for(let e of t)if("gameTime"!=e.field){this.dispatchEvent(new CustomEvent("patch",{detail:t}));break}}teardown(){this.state?.$changes?.root.clearRefs()}handshake(t,r){if(this.state){(new e.Reflection).decode(t,r)}else this.state=e.Reflection.decode(t,r);this.dispatchEvent(new CustomEvent("patch",{detail:null}))}}const an=new on;class cn extends EventTarget{socket=null;transportType=nn("unknown");blueboatRoomId=null;setup(){let e=this;class t extends WebSocket{constructor(t,r){super(t,r),e.socket||e.registerSocket(this)}send(t){e.onSend(t),super.send(t)}}let r=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){this.addEventListener("load",(()=>{if(!this.responseURL.endsWith("/matchmaker/join"))return;let t=JSON.parse(this.responseText);e.blueboatRoomId=t.roomId,console.log("Got Blueboat Room Id: "+e.blueboatRoomId)})),r.apply(this,arguments)},i().WebSocket=t}registerSocket(r){this.socket=r,"Phaser"in i()?(this.transportType.set("colyseus"),this.addEventListener("colyseusMessage",(e=>{if("DEVICES_STATES_CHANGES"!=e.detail.type)return;let t=function(e){let t=[];for(let r of e.changes){let n={},s=r[1].map((t=>e.values[t]));for(let e=0;e<s.length;e++)n[s[e]]=r[2][e];t.push({id:r[0],data:n})}return t}(e.detail.message);this.dispatchEvent(new CustomEvent("deviceChanges",{detail:t}))}))):this.transportType.set("blueboat"),r.addEventListener("message",(r=>{let n;if("colyseus"==sn(this.transportType)){if(n=function(r){const n=Array.from(new Uint8Array(r.data)),i=n[0];if(i===Zr.Protocol.JOIN_ROOM){let e=1;const r=t.utf8Read(n,e);e+=t.utf8Length(r);const s=t.utf8Read(n,e);e+=t.utf8Length(s),console.log(r,s,e),n.length>e&&an.handshake(n,{offset:e})}else if(i===Zr.Protocol.ROOM_DATA_SCHEMA);else if(i===Zr.Protocol.ROOM_STATE)n.shift(),an.setState(n);else if(i===Zr.Protocol.ROOM_STATE_PATCH)n.shift(),an.patch(n);else{if(i===Zr.Protocol.ROOM_DATA){const t={offset:1};return{type:e.decode.stringCheck(n,t)?e.decode.string(n,t):e.decode.number(n,t),message:n.length>t.offset?s.decode(r.data,t.offset):void 0}}if(i===Zr.Protocol.ROOM_DATA_BYTES){const t={offset:1};return{type:e.decode.stringCheck(n,t)?e.decode.string(n,t):e.decode.number(n,t),message:new Uint8Array(n.slice(t.offset))}}}return null}(r),!n)return;this.dispatchEvent(new CustomEvent("colyseusMessage",{detail:n}))}else{if(n=a.decode(r.data),!n)return;this.dispatchEvent(new CustomEvent("blueboatMessage",{detail:n}))}}))}onSend(e){if("blueboat"==sn(this.transportType)&&!this.blueboatRoomId){let t=a.decode(e);t.roomId&&(this.blueboatRoomId=t.roomId),t.room&&(this.blueboatRoomId=t.room),this.blueboatRoomId&&console.log("Got Blueboat Room Id: "+this.blueboatRoomId)}}sendMessage(e,t){if(!this.socket)return;if(!this.blueboatRoomId&&"blueboat"==sn(this.transportType))return;let r;if("colyseus"==sn(this.transportType)){let n=[Zr.Protocol.ROOM_DATA],s=m(e),i=m(t);r=new Uint8Array(s.byteLength+i.byteLength+n.length),r.set(n),r.set(new Uint8Array(s),n.length),r.set(new Uint8Array(i),n.length+s.byteLength)}else r=a.encode(e,t,this.blueboatRoomId);this.socket.send(r)}}const hn=new cn;function ln(e){console.log(e),fetch(e).then((e=>e.text())).then((e=>{const t=e.indexOf(':"App.');if(!t)return void alert("GC: Failed to find the correct script to modify. Please open an issue on GitHub.");const r=e.substring(t-7,t),n=e.lastIndexOf(").register(JSON.parse(",t),s=e.substring(n-7,n),i=new RegExp(`import\\("\\.\\/"\\+(.)\\(${s}\\)\\.resolve\\(${r}\\)\\)`,"g"),o=i.exec(e)?.[1];if(!o)return void alert("GC: Failed to find the correct script to modify. Please open an issue on GitHub.");e=(e=e.replace(i,`new Promise(async (resolve) => {\n    const src = "./"+${o}(${s}).resolve(${r})\n    console.log(src)\n    const res = await fetch(src)\n    let text = await res.text()\n    const endRegex = /assignment:new\\(0,(.)\\.default\\)\\}/\n    const endRes = endRegex.exec(text)\n    const varRegex = /(.)={network:new/\n    const varRes = varRegex.exec(text)\n    if(!endRes[1] || !varRes[1]) {\n        alert("GC: Failed to find the correct script to modify. Please open an issue on GitHub.")\n        return;\n    }\n    text = text.replace(endRegex, 'assignment:new(0,'+endRes[1]+'.default)};window.stores='+varRes[1]+';window.storesLoaded.set(true);console.log("GC: Stores loaded via intercept");')\n\n    const script = document.createElement('script');\n    try {\n        script.appendChild(document.createTextNode(text));\n        document.head.appendChild(script);\n    } catch(e) { \n        script.text = text;\n        document.head.appendChild(script);\n    }\n    setTimeout(resolve, 0)\n})`)).replace(/"\.\/"/g,'"/"');const a=document.createElement("script");a.type="module",document.querySelector("#root")?.remove();let c=document.createElement("div");c.id="root",document.body.appendChild(c);try{a.appendChild(document.createTextNode(e)),document.head.appendChild(a)}catch(t){a.text=e,document.head.appendChild(a)}}))}class un extends EventTarget{_parcelModuleCache={};_parcelModules={};reqIntercepts=[];readyToIntercept=!0;constructor(){super();let e=document.querySelectorAll('script[src*="index"]:not([nomodule])');e.length>0?(this.readyToIntercept=!1,"complete"===document.readyState?(this.setup(),this.reloadExistingScripts(e)):window.addEventListener("load",(()=>{this.setup(),this.reloadExistingScripts(e)}))):this.setup(),i().decachedImport=this.decachedImport.bind(this)}async reloadExistingScripts(e){this.nukeDom(),this.readyToIntercept=!0,this.emptyModules(),e.forEach((e=>{console.log(e,"has already loaded, re-importing..."),this.decachedImport(e.src),e.remove()}))}nukeDom(){document.querySelector("#root")?.remove();let e=document.createElement("div");e.id="root",document.body.appendChild(e);let t=["__mobxGlobals","__mobxInstanceCount"];for(let e of t)e in window&&delete window[e]}async decachedImport(e){let t=new URL(e,location.origin).href,r=await fetch(t),n=await r.text();n=n.replaceAll("import(","window.decachedImport("),n=n.replaceAll("import.meta.url",`'${t}'`);let s=new Blob([n],{type:"application/javascript"}),i=URL.createObjectURL(s);return import(i)}emptyModules(){this._parcelModuleCache={},this._parcelModules={}}interceptRequire(e,t,r=!1){if(!e||!t)throw new Error("match and callback are required");let n={match:e,callback:t,once:r};return this.reqIntercepts.push(n),()=>{let e=this.reqIntercepts.indexOf(n);-1!==e&&this.reqIntercepts.splice(e,1)}}setup(){let e;(e=e=>{if(e in this._parcelModuleCache)return this._parcelModuleCache[e].exports;if(e in this._parcelModules){let t=this._parcelModules[e];delete this._parcelModules[e];let r={id:e,exports:{}};if(this._parcelModuleCache[e]=r,t.call(r.exports,r,r.exports),this.readyToIntercept)for(let e of this.reqIntercepts)if(e.match(r.exports)){let t=e.callback?.(r.exports);t&&(r.exports=t),e.once&&this.reqIntercepts.splice(this.reqIntercepts.indexOf(e),1)}return r.exports}throw new Error(`Cannot find module '${e}'`)}).register=(e,t)=>{this._parcelModules[e]=t,e in this._parcelModuleCache&&delete this._parcelModuleCache[e]},Object.defineProperty(i(),"parcelRequire388b",{value:e,writable:!1,enumerable:!0,configurable:!1})}}const fn=nn(!1);i().storesLoaded=fn;const dn=nn(null);hn.addEventListener("colyseusMessage",(e=>{"AUTH_ID"===e.detail.type&&(dn.set(e.detail.message),console.log("[GC] Got player id: "+e.detail.message))}));const pn=nn(!1);hn.addEventListener("colyseusMessage",(e=>{if("DEVICES_STATES_CHANGES"===e.detail.type){let t=setInterval((()=>{let r=i()?.stores?.phaser?.scene?.worldManager?.devices?.allDevices;r&&r.length>=e.detail.message.changes.length&&(clearInterval(t),pn.set(!0))}),100)}}));let gn=nn(null);if(null!==document.querySelector('script[src*="amplitude.com"]'))alert("This script can only be run before you join the game. Please reload the page and try again.");else{!function(e){e.interceptRequire((e=>e?.default?.characters),(e=>{i().stores=e.default,fn.set(!0),console.log("GC: Stores loaded via parcel")})),e.interceptRequire((e=>e?.CharacterPhysicsConsts),(e=>{gn.set(e.CharacterPhysicsConsts),console.log("GC: Physics constants loaded")}))}(new un),function(){const e=document.querySelector('script[src^="/index"][type="module"]');if(e)return ln(e.src),void console.log("GC: Added modified script",e);let t=new MutationObserver((e=>{for(let r of e)for(let e of r.addedNodes)e instanceof HTMLScriptElement&&e.src.includes("/index")&&"module"==e.type&&(ln(e.src),console.log("GC: Added modified script",e),t.disconnect())}));const r=()=>{t.observe(document.head,{childList:!0})};document.head?r():document.addEventListener("DOMContentLoaded",r)}(),hn.setup()}}(index_mjs,Protocol_js,msgpack);
